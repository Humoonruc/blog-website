<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Humoon" />

<meta name="date" content="2022-04-29" />

<title>单表数据处理</title>

<script src="libs/header-attrs-2.13/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<script src="libs/navigation-1.1/sourceembed.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="../css/style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">单表数据处理</h1>
<h4 class="author">Humoon</h4>
<h4 class="date">2022-04-29</h4>

</div>


<p><a href="../pdf/cheatsheet-dplyr.pdf"><em>dplyr
cheatsheet.pdf</em></a></p>
<object data="../pdf/cheatsheet-dplyr.pdf" type="application/pdf" width="100%" height="100%">
</object>
<p><strong>tidyverse
框架最大的优点在于所有函数的输入输出都是数据框，从而可以通过管道操作链式运算。</strong></p>
<p><strong>dplyr 包中<code>filter()</code>, <code>mutate()</code>
等函数参数中的表达式本质上都是以列为单位的向量化运算</strong></p>
<div id="操作行-manipulate-row" class="section level2">
<h2>操作行 Manipulate Row</h2>
<p>return a subset of rows as a new data</p>
<ul>
<li><code>filter()</code> 条件筛选行</li>
<li><code>slice</code> 索引切片行</li>
<li><code>distinct()</code>
去重，指定以哪些列作为评价基准（其他列舍弃）</li>
<li><code>top_n</code> 选择最大的n行，要指定用以比较的列</li>
<li><code>arrange()</code> 排序</li>
<li><code>add_row</code> 添加行</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">top_n</span>(iris, <span class="dv">5</span>, Sepal.Width) <span class="sc">%&gt;%</span> <span class="fu">setDT</span>()) <span class="co"># 因为并列第5都是3.9，所以筛出来6行</span></span></code></pre></div>
<pre><code>#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#&gt; 1:          5.4         3.9          1.7         0.4  setosa
#&gt; 2:          5.8         4.0          1.2         0.2  setosa
#&gt; 3:          5.7         4.4          1.5         0.4  setosa
#&gt; 4:          5.4         3.9          1.3         0.4  setosa
#&gt; 5:          5.2         4.1          1.5         0.1  setosa
#&gt; 6:          5.5         4.2          1.4         0.2  setosa</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>faithful <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(faithful)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">add_row</span>(faithful, <span class="at">eruptions =</span> <span class="dv">1</span>, <span class="at">waiting =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 273 × 2
#&gt;    eruptions waiting
#&gt;        &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1      3.6       79
#&gt;  2      1.8       54
#&gt;  3      3.33      74
#&gt;  4      2.28      62
#&gt;  5      4.53      85
#&gt;  6      2.88      55
#&gt;  7      4.7       88
#&gt;  8      3.6       85
#&gt;  9      1.95      51
#&gt; 10      4.35      85
#&gt; # … with 263 more rows</code></pre>
<div id="筛选行-filter" class="section level3">
<h3>筛选行 <code>filter()</code></h3>
<p>筛选行可以用下标实现，如<code>flights[8:12,]</code>，<code>head(x, n)</code>和<code>tail(x, n)</code>也能取最前或后若干行。但<code>dplyr::filter()</code>是最灵活的。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 选取1月1日的航班</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>new1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">1</span>, day <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new1)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     1      517            515         2      830            819
#&gt; 2  2013     1     1      533            529         4      850            830
#&gt; 3  2013     1     1      542            540         2      923            850
#&gt; 4  2013     1     1      544            545        -1     1004           1022
#&gt; 5  2013     1     1      554            600        -6      812            837
#&gt; 6  2013     1     1      554            558        -4      740            728
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 选取11月或12月的航班，注意%in%的用法</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>nov_dec <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>nov_dec</span></code></pre></div>
<pre><code>#&gt; # A tibble: 55,403 × 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013    11     1        5           2359         6      352            345
#&gt;  2  2013    11     1       35           2250       105      123           2356
#&gt;  3  2013    11     1      455            500        -5      641            651
#&gt;  4  2013    11     1      539            545        -6      856            827
#&gt;  5  2013    11     1      542            545        -3      831            855
#&gt;  6  2013    11     1      549            600       -11      912            923
#&gt;  7  2013    11     1      550            600       -10      705            659
#&gt;  8  2013    11     1      554            600        -6      659            701
#&gt;  9  2013    11     1      554            600        -6      826            827
#&gt; 10  2013    11     1      554            600        -6      749            751
#&gt; # … with 55,393 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用管道操作</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay), <span class="sc">!</span><span class="fu">is.na</span>(arr_delay))</span></code></pre></div>
<p>filter() 只能筛选出条件为 TRUE 的行；它会排除那些条件为 FALSE
<strong>和 NA 的行。如果想保留缺失值，需要明确指出</strong>。</p>
</div>
<div id="索引切片-silce" class="section level3">
<h3>索引切片 <code>silce()</code></h3>
<p><code>dplyr::slice(data, ...)</code>
可以选择指定序号的行子集，正的序号表示保留，负的序号表示排除。如：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     1      542            540         2      923            850
#&gt; 2  2013     1     1      544            545        -1     1004           1022
#&gt; 3  2013     1     1      554            600        -6      812            837
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="去重行-distinct" class="section level3">
<h3>去重行 <code>distinct()</code></h3>
<p><code>dplyr::distinct()</code>
可以对数据框指定若干变量，然后筛选出所有不同值，每组不同值仅保留一行。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>d.class <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(sex, age, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 11 × 5
#&gt;    name    sex     age height weight
#&gt;    &lt;chr&gt;   &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 Alice   F        13   56.5   84  
#&gt;  2 Gail    F        14   64.3   90  
#&gt;  3 Karen   F        12   56.3   77  
#&gt;  4 Mary    F        15   66.5  112  
#&gt;  5 Sandy   F        11   51.3   50.5
#&gt;  6 Alfred  M        14   69    112. 
#&gt;  7 Guido   M        15   67    133  
#&gt;  8 James   M        12   57.3   83  
#&gt;  9 Jeffrey M        13   62.5   84  
#&gt; 10 Philip  M        16   72    150  
#&gt; 11 Thomas  M        11   57.5   85</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  .keep_all=TRUE 保留数据框中其它变量</span></span></code></pre></div>
</div>
<div id="排列行-arrange" class="section level3">
<h3>排列行 <code>arrange()</code></h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 依次按year, month, day排序；默认升序</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>new2 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(flights, year, month, day)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new2)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     1      517            515         2      830            819
#&gt; 2  2013     1     1      533            529         4      850            830
#&gt; 3  2013     1     1      542            540         2      923            850
#&gt; 4  2013     1     1      544            545        -1     1004           1022
#&gt; 5  2013     1     1      554            600        -6      812            837
#&gt; 6  2013     1     1      554            558        -4      740            728
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用desc()可以按列进行降序排序</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>new2 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(flights, <span class="fu">desc</span>(arr_delay))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new2)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     9      641            900      1301     1242           1530
#&gt; 2  2013     6    15     1432           1935      1137     1607           2120
#&gt; 3  2013     1    10     1121           1635      1126     1239           1810
#&gt; 4  2013     9    20     1139           1845      1014     1457           2210
#&gt; 5  2013     7    22      845           1600      1005     1044           1815
#&gt; 6  2013     4    10     1100           1900       960     1342           2211
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>排序时不论升序还是降序，所有的缺失值都自动排到末尾。</p>
</div>
</div>
<div id="操作列-manipulate-coloum" class="section level2">
<h2>操作列 Manipulate Coloum</h2>
<div id="提取列-pull" class="section level3">
<h3>提取列 <code>pull()</code></h3>
<p>选出一列并从数据框<strong>转化为向量</strong>，其实它就是操作符<code>$</code>的函数化</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>d.class <span class="sc">%&gt;%</span> <span class="fu">pull</span>(name)</span></code></pre></div>
<pre><code>#&gt;  [1] &quot;Alice&quot;   &quot;Becka&quot;   &quot;Gail&quot;    &quot;Karen&quot;   &quot;Kathy&quot;   &quot;Mary&quot;    &quot;Sandy&quot;  
#&gt;  [8] &quot;Sharon&quot;  &quot;Tammy&quot;   &quot;Alfred&quot;  &quot;Duke&quot;    &quot;Guido&quot;   &quot;James&quot;   &quot;Jeffrey&quot;
#&gt; [15] &quot;John&quot;    &quot;Philip&quot;  &quot;Robert&quot;  &quot;Thomas&quot;  &quot;William&quot;</code></pre>
<p><code>pull()</code>可以指定单个变量名，也可以指定变量序号，负的变量序号从最后一个变量数起。</p>
</div>
<div id="挑选列-select" class="section level3">
<h3>挑选列 <code>select()</code></h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>new3 <span class="ot">&lt;-</span> <span class="fu">select</span>(flights, year, month, day)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new3)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;    year month   day
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1  2013     1     1
#&gt; 2  2013     1     1
#&gt; 3  2013     1     1
#&gt; 4  2013     1     1
#&gt; 5  2013     1     1
#&gt; 6  2013     1     1</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 冒号&quot;:&quot;选择 year 和 arr_time 之间的所有列</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year<span class="sc">:</span>arr_time) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 7
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
#&gt; 1  2013     1     1      517            515         2      830
#&gt; 2  2013     1     1      533            529         4      850
#&gt; 3  2013     1     1      542            540         2      923
#&gt; 4  2013     1     1      544            545        -1     1004
#&gt; 5  2013     1     1      554            600        -6      812
#&gt; 6  2013     1     1      554            558        -4      740</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 也可以用数字序号表示范围</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 7
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
#&gt; 1  2013     1     1      517            515         2      830
#&gt; 2  2013     1     1      533            529         4      850
#&gt; 3  2013     1     1      542            540         2      923
#&gt; 4  2013     1     1      544            545        -1     1004
#&gt; 5  2013     1     1      554            600        -6      812
#&gt; 6  2013     1     1      554            558        -4      740</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 负号或!表示扣除</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>new3 <span class="ot">&lt;-</span> <span class="fu">select</span>(flights, <span class="sc">-</span>(year<span class="sc">:</span>day))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new3)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 16
#&gt;   dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
#&gt;      &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
#&gt; 1      517            515         2      830            819        11 UA     
#&gt; 2      533            529         4      850            830        20 UA     
#&gt; 3      542            540         2      923            850        33 AA     
#&gt; 4      544            545        -1     1004           1022       -18 B6     
#&gt; 5      554            600        -6      812            837       -25 DL     
#&gt; 6      554            558        -4      740            728        12 UA     
#&gt; # … with 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;</code></pre>
<p>可以在select()的参数中使用一些辅助函数，界定符合条件的变量</p>
<ul>
<li>starts_with(“abc”) 匹配以’abc’开头的名称。</li>
<li>ends_with(“xyz”) 匹配以’xyz’结尾的名称</li>
<li>contains(“ijk”) 匹配包含’ijk’的名称</li>
<li>matches(“(.)\1”) 选择匹配正则表达式的那些变量</li>
<li>num_range(“x”, 1:3) 匹配x1、x2和x3</li>
<li>one_of()</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new3 <span class="ot">&lt;-</span> <span class="fu">select</span>(flights, <span class="fu">starts_with</span>(<span class="st">&quot;c&quot;</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new3)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 1
#&gt;   carrier
#&gt;   &lt;chr&gt;  
#&gt; 1 UA     
#&gt; 2 UA     
#&gt; 3 AA     
#&gt; 4 B6     
#&gt; 5 DL     
#&gt; 6 UA</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果要选择的变量名已经保存为一个字符型向量</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 可以用 one_of() 引用，直接引用向量名会报错</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;sex&quot;</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>d.class <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(vars))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 19 × 2
#&gt;    name    sex  
#&gt;    &lt;chr&gt;   &lt;fct&gt;
#&gt;  1 Alice   F    
#&gt;  2 Becka   F    
#&gt;  3 Gail    F    
#&gt;  4 Karen   F    
#&gt;  5 Kathy   F    
#&gt;  6 Mary    F    
#&gt;  7 Sandy   F    
#&gt;  8 Sharon  F    
#&gt;  9 Tammy   F    
#&gt; 10 Alfred  M    
#&gt; 11 Duke    M    
#&gt; 12 Guido   M    
#&gt; 13 James   M    
#&gt; 14 Jeffrey M    
#&gt; 15 John    M    
#&gt; 16 Philip  M    
#&gt; 17 Robert  M    
#&gt; 18 Thomas  M    
#&gt; 19 William M</code></pre>
</div>
<div id="排列列-select...-everything" class="section level3">
<h3>排列列 <code>select(...,  everything())</code></h3>
<p>将select()函数和everything()辅助函数结合起来使用。当想要将几个变量移到数据框开头时，这种用法非常奏效。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>new3 <span class="ot">&lt;-</span> <span class="fu">select</span>(flights, time_hour, air_time, <span class="fu">everything</span>())</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new3)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 19
#&gt;   time_hour           air_time  year month   day dep_time sched_dep_time
#&gt;   &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1 2013-01-01 05:00:00      227  2013     1     1      517            515
#&gt; 2 2013-01-01 05:00:00      227  2013     1     1      533            529
#&gt; 3 2013-01-01 05:00:00      160  2013     1     1      542            540
#&gt; 4 2013-01-01 05:00:00      183  2013     1     1      544            545
#&gt; 5 2013-01-01 06:00:00      116  2013     1     1      554            600
#&gt; 6 2013-01-01 05:00:00      150  2013     1     1      554            558
#&gt; # … with 12 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#&gt; #   minute &lt;dbl&gt;</code></pre>
</div>
<div id="重命名列-rename" class="section level3">
<h3>重命名列 <code>rename()</code></h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 这个语法有点怪，前者是新列名，后者是旧列名</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">tail_num =</span> tailnum) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     1      517            515         2      830            819
#&gt; 2  2013     1     1      533            529         4      850            830
#&gt; 3  2013     1     1      542            540         2      923            850
#&gt; 4  2013     1     1      544            545        -1     1004           1022
#&gt; 5  2013     1     1      554            600        -6      812            837
#&gt; 6  2013     1     1      554            558        -4      740            728
#&gt; # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#&gt; #   tail_num &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#&gt; #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>注意这样改名字不是对原始数据框修改而是返回改了名字后的新数据框。</p>
</div>
<div id="添加列-mutate" class="section level3">
<h3>添加列 <code>mutate()</code></h3>
<p>以下都是向量化函数，一行一行地依次操作</p>
<ul>
<li><code>mutate()</code>，新变量添加在最后一列，且创建的新变量可以立即使用在参数中</li>
<li><code>transmute()</code>,
如果只想保留新变量和一部分旧变量，可以使用transmute()函数，未被提及的变量不会被保留。</li>
<li><code>mutate_all()</code>, 计算新列覆盖同名旧列</li>
<li><code>mutate_if()</code>, 按一定条件计算新列覆盖同名旧列</li>
<li><code>add_column()</code>，合并列</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day, <span class="fu">ends_with</span>(<span class="st">&quot;delay&quot;</span>), distance, air_time) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours =</span> air_time <span class="sc">/</span> <span class="dv">60</span>, <span class="at">speed =</span> distance <span class="sc">/</span> hours</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>#&gt; # A tibble: 336,776 × 10
#&gt;     year month   day dep_delay arr_delay distance air_time  gain hours speed
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1  2013     1     1         2        11     1400      227     9 3.78   370.
#&gt;  2  2013     1     1         4        20     1416      227    16 3.78   374.
#&gt;  3  2013     1     1         2        33     1089      160    31 2.67   408.
#&gt;  4  2013     1     1        -1       -18     1576      183   -17 3.05   517.
#&gt;  5  2013     1     1        -6       -25      762      116   -19 1.93   394.
#&gt;  6  2013     1     1        -4        12      719      150    16 2.5    288.
#&gt;  7  2013     1     1        -5        19     1065      158    24 2.63   404.
#&gt;  8  2013     1     1        -3       -14      229       53   -11 0.883  259.
#&gt;  9  2013     1     1        -3        -8      944      140    -5 2.33   405.
#&gt; 10  2013     1     1        -2         8      733      138    10 2.3    319.
#&gt; # … with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>d.class <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cheight =</span> height <span class="sc">-</span> <span class="fu">mean</span>(height)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>#&gt; # A tibble: 19 × 6
#&gt;    name    sex     age height weight cheight
#&gt;    &lt;chr&gt;   &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1 Alice   F        13   56.5   84    -5.84 
#&gt;  2 Becka   F        13   65.3   98     2.96 
#&gt;  3 Gail    F        14   64.3   90     1.96 
#&gt;  4 Karen   F        12   56.3   77    -6.04 
#&gt;  5 Kathy   F        12   59.8   84.5  -2.54 
#&gt;  6 Mary    F        15   66.5  112     4.16 
#&gt;  7 Sandy   F        11   51.3   50.5 -11.0  
#&gt;  8 Sharon  F        15   62.5  112.    0.163
#&gt;  9 Tammy   F        14   62.8  102.    0.463
#&gt; 10 Alfred  M        14   69    112.    6.66 
#&gt; 11 Duke    M        14   63.5  102.    1.16 
#&gt; 12 Guido   M        15   67    133     4.66 
#&gt; 13 James   M        12   57.3   83    -5.04 
#&gt; 14 Jeffrey M        13   62.5   84     0.163
#&gt; 15 John    M        12   59     99.5  -3.34 
#&gt; 16 Philip  M        16   72    150     9.66 
#&gt; 17 Robert  M        12   64.8  128     2.46 
#&gt; 18 Thomas  M        11   57.5   85    -4.84 
#&gt; 19 William M        15   66.5  112     4.16</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(dep_time,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">hour =</span> dep_time <span class="sc">%/%</span> <span class="dv">60</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">minute =</span> dep_time <span class="sc">%%</span> <span class="dv">60</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 336,776 × 3
#&gt;    dep_time  hour minute
#&gt;       &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1      517     8     37
#&gt;  2      533     8     53
#&gt;  3      542     9      2
#&gt;  4      544     9      4
#&gt;  5      554     9     14
#&gt;  6      554     9     14
#&gt;  7      555     9     15
#&gt;  8      557     9     17
#&gt;  9      557     9     17
#&gt; 10      558     9     18
#&gt; # … with 336,766 more rows</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate_all</span>(faithful, <span class="fu">funs</span>(<span class="fu">log</span>(.), <span class="fu">log2</span>(.)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 272 × 6
#&gt;    eruptions waiting eruptions_log waiting_log eruptions_log2 waiting_log2
#&gt;        &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;
#&gt;  1      3.6       79         1.28         4.37          1.85          6.30
#&gt;  2      1.8       54         0.588        3.99          0.848         5.75
#&gt;  3      3.33      74         1.20         4.30          1.74          6.21
#&gt;  4      2.28      62         0.825        4.13          1.19          5.95
#&gt;  5      4.53      85         1.51         4.44          2.18          6.41
#&gt;  6      2.88      55         1.06         4.01          1.53          5.78
#&gt;  7      4.7       88         1.55         4.48          2.23          6.46
#&gt;  8      3.6       85         1.28         4.44          1.85          6.41
#&gt;  9      1.95      51         0.668        3.93          0.963         5.67
#&gt; 10      4.35      85         1.47         4.44          2.12          6.41
#&gt; # … with 262 more rows</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(iris)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate_if</span>(iris, is.numeric, <span class="fu">funs</span>(<span class="fu">log</span>(.)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 150 × 5
#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
#&gt;  1         1.63        1.25        0.336      -1.61  setosa 
#&gt;  2         1.59        1.10        0.336      -1.61  setosa 
#&gt;  3         1.55        1.16        0.262      -1.61  setosa 
#&gt;  4         1.53        1.13        0.405      -1.61  setosa 
#&gt;  5         1.61        1.28        0.336      -1.61  setosa 
#&gt;  6         1.69        1.36        0.531      -0.916 setosa 
#&gt;  7         1.53        1.22        0.336      -1.20  setosa 
#&gt;  8         1.61        1.22        0.405      -1.61  setosa 
#&gt;  9         1.48        1.06        0.336      -1.61  setosa 
#&gt; 10         1.59        1.13        0.405      -2.30  setosa 
#&gt; # … with 140 more rows</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate_at</span>(iris, <span class="fu">vars</span>(<span class="sc">-</span>Species), <span class="fu">funs</span>(<span class="fu">log</span>(.)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 150 × 5
#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
#&gt;  1         1.63        1.25        0.336      -1.61  setosa 
#&gt;  2         1.59        1.10        0.336      -1.61  setosa 
#&gt;  3         1.55        1.16        0.262      -1.61  setosa 
#&gt;  4         1.53        1.13        0.405      -1.61  setosa 
#&gt;  5         1.61        1.28        0.336      -1.61  setosa 
#&gt;  6         1.69        1.36        0.531      -0.916 setosa 
#&gt;  7         1.53        1.22        0.336      -1.20  setosa 
#&gt;  8         1.61        1.22        0.405      -1.61  setosa 
#&gt;  9         1.48        1.06        0.336      -1.61  setosa 
#&gt; 10         1.59        1.13        0.405      -2.30  setosa 
#&gt; # … with 140 more rows</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add_column</span>(mtcars, <span class="at">new =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">32</span>)</span></code></pre></div>
<pre><code>#&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb new
#&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4   1
#&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4   2
#&gt; Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1   3
#&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1   4
#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2   5
#&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1   6
#&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4   7
#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2   8
#&gt; Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2   9
#&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4  10
#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4  11
#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3  12
#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3  13
#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3  14
#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4  15
#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4  16
#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4  17
#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1  18
#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2  19
#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1  20
#&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1  21
#&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2  22
#&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2  23
#&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4  24
#&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2  25
#&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1  26
#&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2  27
#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2  28
#&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4  29
#&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6  30
#&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8  31
#&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2  32</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(iris, <span class="at">Length =</span> Sepal.Length)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 150 × 5
#&gt;    Length Sepal.Width Petal.Length Petal.Width Species
#&gt;     &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
#&gt;  1    5.1         3.5          1.4         0.2 setosa 
#&gt;  2    4.9         3            1.4         0.2 setosa 
#&gt;  3    4.7         3.2          1.3         0.2 setosa 
#&gt;  4    4.6         3.1          1.5         0.2 setosa 
#&gt;  5    5           3.6          1.4         0.2 setosa 
#&gt;  6    5.4         3.9          1.7         0.4 setosa 
#&gt;  7    4.6         3.4          1.4         0.3 setosa 
#&gt;  8    5           3.4          1.5         0.2 setosa 
#&gt;  9    4.4         2.9          1.4         0.2 setosa 
#&gt; 10    4.9         3.1          1.5         0.1 setosa 
#&gt; # … with 140 more rows</code></pre>
</div>
<div id="计算新列的函数" class="section level3">
<h3>计算新列的函数</h3>
<p>这些函数配合 <code>mutate()</code> 和
<code>transmutate()</code>，input一个列向量，output一个列向量</p>
<div id="顺序序号" class="section level4">
<h4>顺序序号</h4>
<ul>
<li><code>seq_along(along.with)</code>
根据输入的列的长度，产生一列从1到N的顺序序号，很像 data.table
包中的<code>1:.N</code></li>
</ul>
</div>
<div id="偏移-offset" class="section level4">
<h4>偏移 offset</h4>
<ul>
<li><code>dplyr::lag()</code> 后退偏移</li>
<li><code>dplyr::lead()</code> 前进偏移</li>
</ul>
</div>
<div id="累计-cumulative" class="section level4">
<h4>累计 cumulative</h4>
<ul>
<li><code>cumsum()</code> 累计和，分组后计算1-12月累计值非常有用</li>
<li><code>cumprod()</code> 累计积</li>
<li><code>cummin()/cummax</code> 累计最小/大值</li>
<li><code>dplyr::cummean()</code> 累计平均值</li>
<li><code>dplyr::cumall()</code> 累计all（逻辑判断）</li>
<li><code>dplyr::cumany()</code> 累计any（逻辑判断）</li>
</ul>
</div>
<div id="排序位置-rank" class="section level4">
<h4>排序位置 rank</h4>
<p>见 cheatsheet</p>
</div>
<div id="数学运算" class="section level4">
<h4>数学运算</h4>
<p>见 cheatsheet</p>
</div>
<div id="其他" class="section level4">
<h4>其他</h4>
<p>见 cheatsheet</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Carol&quot;</span>, <span class="st">&quot;Carol&quot;</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;english&quot;</span>, <span class="st">&quot;math&quot;</span>, <span class="st">&quot;english&quot;</span>, <span class="st">&quot;math&quot;</span>, <span class="st">&quot;english&quot;</span>, <span class="st">&quot;math&quot;</span>),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> <span class="fu">c</span>(<span class="fl">60.2</span>, <span class="fl">90.5</span>, <span class="fl">92.2</span>, <span class="fl">98.8</span>, <span class="fl">82.5</span>, <span class="fl">74.6</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># if_else( , , )，用 ifelse( ? : )会报错</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 因为 ifelse() 不是向量化运算函数</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess =</span> <span class="fu">if_else</span>(score <span class="sc">&gt;</span> <span class="dv">85</span>, <span class="st">&quot;very_good&quot;</span>, <span class="st">&quot;good&quot;</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   name  type    score assess   
#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    
#&gt; 1 Alice english  60.2 good     
#&gt; 2 Alice math     90.5 very_good
#&gt; 3 Bob   english  92.2 very_good
#&gt; 4 Bob   math     98.8 very_good
#&gt; 5 Carol english  82.5 good     
#&gt; 6 Carol math     74.6 good</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    score <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">&quot;general&quot;</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    score <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> score <span class="sc">&lt;</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">&quot;good&quot;</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    score <span class="sc">&gt;=</span> <span class="dv">80</span> <span class="sc">&amp;</span> score <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">&quot;very_good&quot;</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    score <span class="sc">&gt;=</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">&quot;best&quot;</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;other&quot;</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   name  type    score assess   
#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    
#&gt; 1 Alice english  60.2 general  
#&gt; 2 Alice math     90.5 best     
#&gt; 3 Bob   english  92.2 best     
#&gt; 4 Bob   math     98.8 best     
#&gt; 5 Carol english  82.5 very_good
#&gt; 6 Carol math     74.6 good</code></pre>
</div>
</div>
</div>
<div id="分组行-group-row" class="section level2">
<h2>分组行 Group Row</h2>
<div id="group_by" class="section level4">
<h4><code>group_by()</code></h4>
<p>创建一个分好组的原数据的copy，等待进一步指令，然后分组执行。</p>
</div>
<div id="ungroup" class="section level4">
<h4><code>ungroup()</code></h4>
<p>逆操作，生成一个数据的 ungrouped copy</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(mpg))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;     cyl   avg
#&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     4  26.7
#&gt; 2     6  19.7
#&gt; 3     8  15.1</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>g_iris <span class="ot">&lt;-</span> <span class="fu">group_by</span>(iris, Species)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>(g_iris)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 150 × 5
#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
#&gt;  1          5.1         3.5          1.4         0.2 setosa 
#&gt;  2          4.9         3            1.4         0.2 setosa 
#&gt;  3          4.7         3.2          1.3         0.2 setosa 
#&gt;  4          4.6         3.1          1.5         0.2 setosa 
#&gt;  5          5           3.6          1.4         0.2 setosa 
#&gt;  6          5.4         3.9          1.7         0.4 setosa 
#&gt;  7          4.6         3.4          1.4         0.3 setosa 
#&gt;  8          5           3.4          1.5         0.2 setosa 
#&gt;  9          4.4         2.9          1.4         0.2 setosa 
#&gt; 10          4.9         3.1          1.5         0.1 setosa 
#&gt; # … with 140 more rows</code></pre>
<p>虽然group_by()与summarize()结合起来使用是最有效的，但分组也可以与filter()和mutate()结合，以完成非常便捷的操作：如</p>
<ul>
<li>找出每个分组中最差的成员</li>
<li>找出大于某个阈值的所有分组</li>
<li>对数据进行标准化以计算分组指标</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 每天到达延误时间最长的航班</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day, <span class="fu">ends_with</span>(<span class="st">&quot;delay&quot;</span>), distance, air_time) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">rank</span>(<span class="fu">desc</span>(arr_delay)) <span class="sc">&lt;</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3,306 × 7
#&gt; # Groups:   year, month, day [365]
#&gt;     year month   day dep_delay arr_delay distance air_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1  2013     1     1       853       851      184       41
#&gt;  2  2013     1     1       290       338     1134      213
#&gt;  3  2013     1     1       260       263      266       46
#&gt;  4  2013     1     1       157       174      213       60
#&gt;  5  2013     1     1       216       222      708      121
#&gt;  6  2013     1     1       255       250      589      115
#&gt;  7  2013     1     1       285       246     1085      146
#&gt;  8  2013     1     1       192       191      199       44
#&gt;  9  2013     1     1       379       456     1092      222
#&gt; 10  2013     1     2       224       207      550       94
#&gt; # … with 3,296 more rows</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 大于365个航班的航线</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>popular_dests <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">365</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>popular_dests</span></code></pre></div>
<pre><code>#&gt; # A tibble: 332,577 × 19
#&gt; # Groups:   dest [77]
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1      533            529         4      850            830
#&gt;  3  2013     1     1      542            540         2      923            850
#&gt;  4  2013     1     1      544            545        -1     1004           1022
#&gt;  5  2013     1     1      554            600        -6      812            837
#&gt;  6  2013     1     1      554            558        -4      740            728
#&gt;  7  2013     1     1      555            600        -5      913            854
#&gt;  8  2013     1     1      557            600        -3      709            723
#&gt;  9  2013     1     1      557            600        -3      838            846
#&gt; 10  2013     1     1      558            600        -2      753            745
#&gt; # … with 332,567 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 对数据进行标准化以计算分组指标</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>popular_dests <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_delay =</span> arr_delay <span class="sc">/</span> <span class="fu">sum</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day, dest, arr_delay, prop_delay)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 131,106 × 6
#&gt; # Groups:   dest [77]
#&gt;     year month   day dest  arr_delay prop_delay
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt;  1  2013     1     1 IAH          11  0.000111 
#&gt;  2  2013     1     1 IAH          20  0.000201 
#&gt;  3  2013     1     1 MIA          33  0.000235 
#&gt;  4  2013     1     1 ORD          12  0.0000424
#&gt;  5  2013     1     1 FLL          19  0.0000938
#&gt;  6  2013     1     1 ORD           8  0.0000283
#&gt;  7  2013     1     1 LAX           7  0.0000344
#&gt;  8  2013     1     1 DFW          31  0.000282 
#&gt;  9  2013     1     1 ATL          12  0.0000400
#&gt; 10  2013     1     1 DTW          16  0.000116 
#&gt; # … with 131,096 more rows</code></pre>
</div>
<div id="按多个变量分组" class="section level3">
<h3>按多个变量分组</h3>
<p>当使用多个变量进行分组时，每次的摘要统计会用掉一个分组变量。这样就可以轻松地对数据集进行循序渐进的分析。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>daily <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, year, month, day)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>(per_day <span class="ot">&lt;-</span> <span class="fu">summarize</span>(daily, <span class="at">flights =</span> <span class="fu">n</span>()))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day flights
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
#&gt;  1  2013     1     1     842
#&gt;  2  2013     1     2     943
#&gt;  3  2013     1     3     914
#&gt;  4  2013     1     4     915
#&gt;  5  2013     1     5     720
#&gt;  6  2013     1     6     832
#&gt;  7  2013     1     7     933
#&gt;  8  2013     1     8     899
#&gt;  9  2013     1     9     902
#&gt; 10  2013     1    10     932
#&gt; # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>(per_month <span class="ot">&lt;-</span> <span class="fu">summarize</span>(per_day, <span class="at">flights =</span> <span class="fu">sum</span>(flights)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 12 × 3
#&gt; # Groups:   year [1]
#&gt;     year month flights
#&gt;    &lt;int&gt; &lt;int&gt;   &lt;int&gt;
#&gt;  1  2013     1   27004
#&gt;  2  2013     2   24951
#&gt;  3  2013     3   28834
#&gt;  4  2013     4   28330
#&gt;  5  2013     5   28796
#&gt;  6  2013     6   28243
#&gt;  7  2013     7   29425
#&gt;  8  2013     8   29327
#&gt;  9  2013     9   27574
#&gt; 10  2013    10   28889
#&gt; 11  2013    11   27268
#&gt; 12  2013    12   28135</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>(per_year <span class="ot">&lt;-</span> <span class="fu">summarize</span>(per_month, <span class="at">flights =</span> <span class="fu">sum</span>(flights)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;    year flights
#&gt;   &lt;int&gt;   &lt;int&gt;
#&gt; 1  2013  336776</code></pre>
</div>
<div id="取消分组" class="section level3">
<h3>取消分组</h3>
<p>取消分组，并回到未分组的数据继续操作，可以使用 ungroup()</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>daily <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="co"># 取消分组</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">flights =</span> <span class="fu">n</span>()) <span class="co"># 全年所有航班</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 1
#&gt;   flights
#&gt;     &lt;int&gt;
#&gt; 1  336776</code></pre>
</div>
</div>
<div id="摘要统计列-summarize-column" class="section level2">
<h2>摘要统计列 Summarize Column</h2>
<div id="summarise-统计" class="section level4">
<h4><code>summarise()</code> 统计</h4>
<ul>
<li><strong>summarize()与group_by()的组合构成了使用dplyr包时最常用的操作之一——分组摘要统计。</strong></li>
<li>summarize()将生成一个新的数据框，包含的变量只有分组依据变量和写进summarize()参数的统计摘要变量（可以一次统计多个量）</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(mpg))</span></code></pre></div>
<pre><code>#&gt;        avg
#&gt; 1 20.09062</code></pre>
</div>
<div id="count-按该列值的-level-分组计数" class="section level4">
<h4><code>count()</code> 按该列值的 level 分组计数</h4>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Carol&quot;</span>, <span class="st">&quot;Carol&quot;</span>),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;english&quot;</span>, <span class="st">&quot;math&quot;</span>, <span class="st">&quot;english&quot;</span>, <span class="st">&quot;math&quot;</span>, <span class="st">&quot;english&quot;</span>, <span class="st">&quot;math&quot;</span>),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> <span class="fu">c</span>(<span class="fl">60.2</span>, <span class="fl">90.5</span>, <span class="fl">92.2</span>, <span class="fl">98.8</span>, <span class="fl">82.5</span>, <span class="fl">74.6</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 加权 count</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(name,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sort =</span> <span class="cn">TRUE</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">wt =</span> score,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;total_score&quot;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;   name  total_score
#&gt;   &lt;chr&gt;       &lt;dbl&gt;
#&gt; 1 Bob          191 
#&gt; 2 Carol        157.
#&gt; 3 Alice        151.</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 等价于</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_score =</span> <span class="fu">sum</span>(score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_score))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 3
#&gt;   name      n total_score
#&gt;   &lt;chr&gt; &lt;int&gt;       &lt;dbl&gt;
#&gt; 1 Bob       2        191 
#&gt; 2 Carol     2        157.
#&gt; 3 Alice     2        151.</code></pre>
</div>
<div id="add_count-增加一个-count-列" class="section level4">
<h4><code>add_count()</code> 增加一个 count 列</h4>
<p>增加一列，代表每人参加的考试次数</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">add_count</span>(name)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   name  type    score     n
#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;
#&gt; 1 Alice english  60.2     2
#&gt; 2 Alice math     90.5     2
#&gt; 3 Bob   english  92.2     2
#&gt; 4 Bob   math     98.8     2
#&gt; 5 Carol english  82.5     2
#&gt; 6 Carol math     74.6     2</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 等价于</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   name  type    score     n
#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;
#&gt; 1 Alice english  60.2     2
#&gt; 2 Alice math     90.5     2
#&gt; 3 Bob   english  92.2     2
#&gt; 4 Bob   math     98.8     2
#&gt; 5 Carol english  82.5     2
#&gt; 6 Carol math     74.6     2</code></pre>
</div>
<div id="摘要统计函数" class="section level3">
<h3>摘要统计函数</h3>
<p>配合在 <code>summarise()</code>
内部使用，占据第二个参数位置。input一个向量，output一个值。</p>
<ul>
<li><code>sum()</code>, <code>mean()</code>, <code>cumsum()</code></li>
<li>统计总/去重后/非空行数 <code>n()</code>, <code>n_distinct()</code>,
<code>sum(!is.na())</code></li>
<li>定位度量 <code>first()</code>, <code>last()</code>,
<code>nth()</code></li>
<li>秩的度量 <code>min()</code>, <code>max()</code>,
<code>quantile(x, 0.25)</code></li>
<li>离散程度 <code>sd()</code>、<code>var()</code>, <code>mad()</code>,
<code>IQR()</code></li>
</ul>
<p>例1 观察航班数据的若干统计量</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by_date是flights按年月日分组后的新数据</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>by_date <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, year, month, day)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 由此得到每一天的平均延误时间。</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(by_date, <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day delay
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
#&gt;  1  2013     1     1 11.5 
#&gt;  2  2013     1     2 13.9 
#&gt;  3  2013     1     3 11.0 
#&gt;  4  2013     1     4  8.95
#&gt;  5  2013     1     5  5.73
#&gt;  6  2013     1     6  7.15
#&gt;  7  2013     1     7  5.42
#&gt;  8  2013     1     8  2.55
#&gt;  9  2013     1     9  2.28
#&gt; 10  2013     1    10  2.84
#&gt; # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 也可以用管道操作写成</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day delay
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
#&gt;  1  2013     1     1 11.5 
#&gt;  2  2013     1     2 13.9 
#&gt;  3  2013     1     3 11.0 
#&gt;  4  2013     1     4  8.95
#&gt;  5  2013     1     5  5.73
#&gt;  6  2013     1     6  7.15
#&gt;  7  2013     1     7  5.42
#&gt;  8  2013     1     8  2.55
#&gt;  9  2013     1     9  2.28
#&gt; 10  2013     1    10  2.84
#&gt; # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 也可以预先去掉存在NA（航班取消）的行，写成</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay), <span class="sc">!</span><span class="fu">is.na</span>(arr_delay))</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">delay =</span> <span class="fu">mean</span>(dep_delay))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day delay
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
#&gt;  1  2013     1     1 11.4 
#&gt;  2  2013     1     2 13.7 
#&gt;  3  2013     1     3 10.9 
#&gt;  4  2013     1     4  8.97
#&gt;  5  2013     1     5  5.73
#&gt;  6  2013     1     6  7.15
#&gt;  7  2013     1     7  5.42
#&gt;  8  2013     1     8  2.56
#&gt;  9  2013     1     9  2.30
#&gt; 10  2013     1    10  2.84
#&gt; # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 观察平均正延误时间</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">delay_pos =</span> <span class="fu">mean</span>(dep_delay[dep_delay <span class="sc">&gt;</span> <span class="dv">0</span>]))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day delay_pos
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
#&gt;  1  2013     1     1      32.6
#&gt;  2  2013     1     2      32.4
#&gt;  3  2013     1     3      28.3
#&gt;  4  2013     1     4      26.2
#&gt;  5  2013     1     5      21.8
#&gt;  6  2013     1     6      22.1
#&gt;  7  2013     1     7      26.2
#&gt;  8  2013     1     8      21.3
#&gt;  9  2013     1     9      26.5
#&gt; 10  2013     1    10      32.6
#&gt; # … with 355 more rows</code></pre>
<p>例2
按目的地分组，按目的地分组，研究平均飞行距离与平均延误时间之间的关系</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据目的地分组</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>by_dest <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, dest)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 用mean()统计平均飞行距离和平均延误时间</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 用n()统计航班数，sum(!is_na())非缺失值记数</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>sum_data <span class="ot">&lt;-</span> <span class="fu">summarize</span>(by_dest,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist =</span> <span class="fu">mean</span>(distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 筛选出航班数大于20（去除小样本）且目的地不为&#39;HNL&#39;的行</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co"># HNL这个机场在夏威夷，距离太远属于异常值</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>delay <span class="ot">&lt;-</span> <span class="fu">filter</span>(sum_data, count <span class="sc">&gt;</span> <span class="dv">29</span>, dest <span class="sc">!=</span> <span class="st">&quot;HNL&quot;</span>)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 作图</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> delay)) <span class="sc">+</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count), <span class="at">alpha =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="../img/example2-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 管道操作</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 这样写代码很清晰，每一行是一步操作</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> <span class="co"># 分组</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(), <span class="at">dist =</span> <span class="fu">mean</span>(distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co"># 统计</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">29</span>, dest <span class="sc">!=</span> <span class="st">&quot;HNL&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># 筛选观测</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> delay)) <span class="sc">+</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> count), <span class="at">alpha =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="co"># 作图</span></span></code></pre></div>
<p><img src="../img/example2-2.png" width="90%" style="display: block; margin: auto;" />
可见，750英里内，平均延误时间会随着距离的增加而增加，接着会随着距离的增加而减少。或许，随着飞行距离的增加，延误时间有可能会在飞行中弥补回来。</p>
<p>例3 查看具有最长平均延误时间的航班</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 通过尾号（tailnum）对航班进行分组识别</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">delay =</span> <span class="fu">mean</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> delay)) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="../img/example3-1-1.png" width="90%" style="display: block; margin: auto;" />
有些航班的平均延误时间长达300分钟，这是怎么回事呢？</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 作航班架次数量和平均延误时间的散点图</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">delay =</span> <span class="fu">mean</span>(arr_delay), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> delay)) <span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="../img/example3-2-1.png" width="90%" style="display: block; margin: auto;" />
由图可见，当航班数量非常少时，平均延误时间的变动特别大。</p>
<p>注：这张图的形状非常能够说明问题：当绘制均值（或其他摘要统计量）和分组规模的关系时，总能看到随着样本量的增加，变动在不断减小。因此，查看此类图形时，<strong>通常应该筛选掉那些观测数量非常少的分组，这样就可以避免受到特别小的分组中的极端变动的影响，进而更好地发现数据模式</strong>。</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 作去掉小样本后，航班架次数量和平均延误时间的散点图</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">delay =</span> <span class="fu">mean</span>(arr_delay), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> delay)) <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="../img/example3-3-1.png" width="90%" style="display: block; margin: auto;" />
这时我们发现，平均延误时间大多在20分钟以下；飞行架次在30以上的航班，平均延误时间最长的也只有60分钟。</p>
<p>例4
棒球击球手的安打率与击球次数之间的关系（能力与出场机会的关系）</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒球比赛数据，转换成tibble使输出更美观</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>batting <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Lahman<span class="sc">::</span>Batting)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据球员ID分组统计，总击打数ab和安打率ba（安打数/击打数）</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组统计后包含playerID, ab, ba变量的新数据框为batters</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>batters <span class="ot">&lt;-</span> batting <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(playerID) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ba =</span> <span class="fu">sum</span>(H, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(AB, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ab =</span> <span class="fu">sum</span>(AB, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 按安打率排名，发现位次最靠前的是一些总击打数几乎为零、</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 靠好运气获得极高安打率的球员——而这并不表明能力强。</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>batters <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(ba))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 19,898 × 3
#&gt;    playerID     ba    ab
#&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
#&gt;  1 abramge01     1     1
#&gt;  2 alanirj01     1     1
#&gt;  3 alberan01     1     1
#&gt;  4 banisje01     1     1
#&gt;  5 bartocl01     1     1
#&gt;  6 bassdo01      1     1
#&gt;  7 birasst01     1     2
#&gt;  8 bruneju01     1     1
#&gt;  9 burnscb01     1     1
#&gt; 10 cammaer01     1     1
#&gt; # … with 19,888 more rows</code></pre>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>batters <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ab, <span class="at">y =</span> ba)) <span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="../img/example4-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 忽略小样本，绘制安打率~击打数散点图，发现安打率基本小于35%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 正相关关系，说明安打率较高的球员击打数较多（出场机会多）</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 由图可见，拥有20%以上的安打率，才有机会成为球队主力</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>batters <span class="sc">%&gt;%</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ab <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ab, <span class="at">y =</span> ba)) <span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="../img/example4-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 从N.Y.到其他机场飞行距离的标准差</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">distance_sd =</span> <span class="fu">sd</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(distance_sd))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 104 × 2
#&gt;    dest  distance_sd
#&gt;    &lt;chr&gt;       &lt;dbl&gt;
#&gt;  1 EGE         10.5 
#&gt;  2 SAN         10.4 
#&gt;  3 SFO         10.2 
#&gt;  4 HNL         10.0 
#&gt;  5 SEA          9.98
#&gt;  6 LAS          9.91
#&gt;  7 PDX          9.87
#&gt;  8 PHX          9.86
#&gt;  9 LAX          9.66
#&gt; 10 IND          9.46
#&gt; # … with 94 more rows</code></pre>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 每天最早和最晚航班的出发时间</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">first =</span> <span class="fu">min</span>(dep_time), <span class="at">last =</span> <span class="fu">max</span>(dep_time))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 5
#&gt; # Groups:   year, month [12]
#&gt;     year month   day first  last
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt;  1  2013     1     1   517  2356
#&gt;  2  2013     1     2    42  2354
#&gt;  3  2013     1     3    32  2349
#&gt;  4  2013     1     4    25  2358
#&gt;  5  2013     1     5    14  2357
#&gt;  6  2013     1     6    16  2355
#&gt;  7  2013     1     7    49  2359
#&gt;  8  2013     1     8   454  2351
#&gt;  9  2013     1     9     2  2252
#&gt; 10  2013     1    10     3  2320
#&gt; # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 找出每天最早和最晚出发的航班</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># min_rank(x)可以返回一个序列各元素的升序位置向量</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># min_rank(desc(x))返回降序位置向量</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 对出发时间排序后，用range()取出最大值和最小值</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 再用filter()取出每天出发最早和最晚的航班</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(dep_time))) <span class="sc">%&gt;%</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(r <span class="sc">%in%</span> <span class="fu">range</span>(r))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 770 × 20
#&gt; # Groups:   year, month, day [365]
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1     1      517            515         2      830            819
#&gt;  2  2013     1     1     2356           2359        -3      425            437
#&gt;  3  2013     1     2       42           2359        43      518            442
#&gt;  4  2013     1     2     2354           2359        -5      413            437
#&gt;  5  2013     1     3       32           2359        33      504            442
#&gt;  6  2013     1     3     2349           2359       -10      434            445
#&gt;  7  2013     1     4       25           2359        26      505            442
#&gt;  8  2013     1     4     2358           2359        -1      429            437
#&gt;  9  2013     1     4     2358           2359        -1      436            445
#&gt; 10  2013     1     5       14           2359        15      503            445
#&gt; # … with 760 more rows, and 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#&gt; #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, r &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 纽约至哪个目的地的航线有最多的航空公司运营</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># n_distinct()函数统计唯一值的数量</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">carriers =</span> <span class="fu">n_distinct</span>(carrier)) <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(carriers))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 104 × 2
#&gt;    dest  carriers
#&gt;    &lt;chr&gt;    &lt;int&gt;
#&gt;  1 ATL          7
#&gt;  2 BOS          7
#&gt;  3 CLT          7
#&gt;  4 ORD          7
#&gt;  5 TPA          7
#&gt;  6 AUS          6
#&gt;  7 DCA          6
#&gt;  8 DTW          6
#&gt;  9 IAD          6
#&gt; 10 MSP          6
#&gt; # … with 94 more rows</code></pre>
<div class="sourceCode" id="cb110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 纽约出发的每条航线有多少个航班</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> <span class="fu">count</span>(dest)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 104 × 2
#&gt;    dest      n
#&gt;    &lt;chr&gt; &lt;int&gt;
#&gt;  1 ABQ     254
#&gt;  2 ACK     264
#&gt;  3 ALB     418
#&gt;  4 ANC       8
#&gt;  5 ATL   16837
#&gt;  6 AUS    2411
#&gt;  7 AVL     261
#&gt;  8 BDL     412
#&gt;  9 BGR     358
#&gt; 10 BHM     269
#&gt; # … with 94 more rows</code></pre>
<div class="sourceCode" id="cb112"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 加权记数，计算每个航班的总飞行距离</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span> <span class="fu">count</span>(tailnum, <span class="at">wt =</span> distance)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 4,037 × 2
#&gt;    tailnum      n
#&gt;    &lt;chr&gt;    &lt;dbl&gt;
#&gt;  1 D942DN    3418
#&gt;  2 N0EGMQ  239143
#&gt;  3 N10156  109664
#&gt;  4 N102UW   25722
#&gt;  5 N103US   24619
#&gt;  6 N104UW   24616
#&gt;  7 N10575  139903
#&gt;  8 N105UW   23618
#&gt;  9 N107US   21677
#&gt; 10 N108UW   32070
#&gt; # … with 4,027 more rows</code></pre>
<div class="sourceCode" id="cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 若x为逻辑向量，sum(x)可以找出x中TRUE的数量，mean(x)可以找出x中TRUE的比例。</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 每天有多少架航班是早上5点前出发的</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_early =</span> <span class="fu">sum</span>(dep_time <span class="sc">&lt;</span> <span class="dv">500</span>))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day n_early
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
#&gt;  1  2013     1     1       0
#&gt;  2  2013     1     2       3
#&gt;  3  2013     1     3       4
#&gt;  4  2013     1     4       3
#&gt;  5  2013     1     5       3
#&gt;  6  2013     1     6       2
#&gt;  7  2013     1     7       2
#&gt;  8  2013     1     8       1
#&gt;  9  2013     1     9       3
#&gt; 10  2013     1    10       3
#&gt; # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 延误超过1小时的航班比例是多少</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>not_cancelled <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">hour_perc =</span> <span class="fu">mean</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">60</span>))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 365 × 4
#&gt; # Groups:   year, month [12]
#&gt;     year month   day hour_perc
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
#&gt;  1  2013     1     1    0.0722
#&gt;  2  2013     1     2    0.0851
#&gt;  3  2013     1     3    0.0567
#&gt;  4  2013     1     4    0.0396
#&gt;  5  2013     1     5    0.0349
#&gt;  6  2013     1     6    0.0470
#&gt;  7  2013     1     7    0.0333
#&gt;  8  2013     1     8    0.0213
#&gt;  9  2013     1     9    0.0202
#&gt; 10  2013     1    10    0.0183
#&gt; # … with 355 more rows</code></pre>
</div>
</div>

<div id="rmd-source-code">LS0tDQp0aXRsZTogIuWNleihqOaVsOaNruWkhOeQhiINCnN1YnRpdGxlOiAnJw0KYXV0aG9yOiAiSHVtb29uIg0KZGF0ZTogImByIFN5cy5EYXRlKClgIg0Kb3V0cHV0OiBodG1sX2RvY3VtZW50DQpkb2N1bWVudGNsYXNzOiBjdGV4YXJ0DQpjbGFzc29wdGlvbjogaHlwZXJyZWYsDQotLS0NCg0KYGBge3Igc2V0dXAsIGluY2x1ZGU9RkFMU0V9DQpzb3VyY2UoIi4uL1JtYXJrZG93bi10ZW1wbGF0ZS9SbWFya2Rvd25fY29uZmlnLlIiKQ0KDQojIyBnbG9iYWwgb3B0aW9ucyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0Ka25pdHI6Om9wdHNfY2h1bmskc2V0KA0KICB3aWR0aCA9IGNvbmZpZyR3aWR0aCwNCiAgZmlnLndpZHRoID0gY29uZmlnJGZpZy53aWR0aCwNCiAgZmlnLmFzcCA9IGNvbmZpZyRmaWcuYXNwLA0KICBvdXQud2lkdGggPSBjb25maWckb3V0LndpZHRoLA0KICBmaWcuYWxpZ24gPSBjb25maWckZmlnLmFsaWduLA0KICBmaWcucGF0aCA9IGNvbmZpZyRmaWcucGF0aCwNCiAgZmlnLnNob3cgPSBjb25maWckZmlnLnNob3csDQogIHdhcm4gPSBjb25maWckd2FybiwNCiAgd2FybmluZyA9IGNvbmZpZyR3YXJuaW5nLA0KICBtZXNzYWdlID0gY29uZmlnJG1lc3NhZ2UsDQogIGVjaG8gPSBjb25maWckZWNobywNCiAgZXZhbCA9IGNvbmZpZyRldmFsLA0KICB0aWR5ID0gY29uZmlnJHRpZHksDQogIGNvbW1lbnQgPSBjb25maWckY29tbWVudCwNCiAgY29sbGFwc2UgPSBjb25maWckY29sbGFwc2UsDQogIGNhY2hlID0gY29uZmlnJGNhY2hlLA0KICBjYWNoZS5jb21tZW50cyA9IGNvbmZpZyRjYWNoZS5jb21tZW50cywNCiAgYXV0b2RlcCA9IGNvbmZpZyRhdXRvZGVwDQopDQpgYGANCg0KDQo8YSBocmVmPSIuLi9wZGYvY2hlYXRzaGVldC1kcGx5ci5wZGYiPipkcGx5ciBjaGVhdHNoZWV0LnBkZio8L2E+DQoNCjxvYmplY3QgZGF0YT0iLi4vcGRmL2NoZWF0c2hlZXQtZHBseXIucGRmIiB0eXBlPSJhcHBsaWNhdGlvbi9wZGYiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjwvb2JqZWN0Pg0KDQoNCioqdGlkeXZlcnNlIOahhuaetuacgOWkp+eahOS8mOeCueWcqOS6juaJgOacieWHveaVsOeahOi+k+WFpei+k+WHuumDveaYr+aVsOaNruahhu+8jOS7juiAjOWPr+S7pemAmui/h+euoemBk+aTjeS9nOmTvuW8j+i/kOeul+OAgioqDQoNCioqZHBseXIg5YyF5LitYGZpbHRlcigpYCwgYG11dGF0ZSgpYCDnrYnlh73mlbDlj4LmlbDkuK3nmoTooajovr7lvI/mnKzotKjkuIrpg73mmK/ku6XliJfkuLrljZXkvY3nmoTlkJHph4/ljJbov5DnrpcqKg0KDQpgYGB7ciwgZWNobz1GQUxTRX0NCmxpYnJhcnkoInJlc2hhcGUyIikNCmxpYnJhcnkoIm55Y2ZsaWdodHMxMyIpDQojIOiLpemcgOWcqOihjOWGheaPkuWFpeaVsOWAvO+8jOiHquWumuS5ieS/neeVmeWwj+aVsOS9jeaVsOOAgeWinuWKoOWNg+S9jeWIhumalOespueahOWHveaVsGNvbW1hDQpjb21tYSA8LSBmdW5jdGlvbih4KSBmb3JtYXQoeCwgZGlnaXRzID0gMiwgYmlnLm1hcmsgPSAiLCIpDQoNCiMjIOaVsOaNruWHhuWkhw0KIyBueWNmbGlnaHRzMTM6OmZsaWdodHMgIyBmbGlnaHRzIGRlcGFydCBmcm9tIE5ldyBZb3JrIGluIDIwMTMNCmQuY2xhc3MgPC0NCiAgcmVhZF9jc3YoImNsYXNzLmNzdiIsDQogICAgY29sX3R5cGVzID0gY29scygNCiAgICAgIC5kZWZhdWx0ID0gY29sX2RvdWJsZSgpLA0KICAgICAgbmFtZSA9IGNvbF9jaGFyYWN0ZXIoKSwNCiAgICAgIHNleCA9IGNvbF9mYWN0b3IobGV2ZWxzID0gYygiTSIsICJGIikpDQogICAgKQ0KICApDQpsaWJyYXJ5KE5IQU5FUykNCmRhdGEoTkhBTkVTKQ0KYGBgDQoNCiMjIOaTjeS9nOihjCBNYW5pcHVsYXRlIFJvdw0KDQpyZXR1cm4gYSBzdWJzZXQgb2Ygcm93cyBhcyBhIG5ldyBkYXRhDQoNCi0gICBgZmlsdGVyKClgIOadoeS7tuetm+mAieihjA0KLSAgIGBzbGljZWAg57Si5byV5YiH54mH6KGMDQotICAgYGRpc3RpbmN0KClgIOWOu+mHje+8jOaMh+WumuS7peWTquS6m+WIl+S9nOS4uuivhOS7t+WfuuWHhu+8iOWFtuS7luWIl+iIjeW8g++8iQ0KLSAgIGB0b3BfbmAg6YCJ5oup5pyA5aSn55qEbuihjO+8jOimgeaMh+WumueUqOS7peavlOi+g+eahOWIlw0KLSAgIGBhcnJhbmdlKClgIOaOkuW6jw0KLSAgIGBhZGRfcm93YCDmt7vliqDooYwNCg0KYGBge3J9DQoodG9wX24oaXJpcywgNSwgU2VwYWwuV2lkdGgpICU+JSBzZXREVCgpKSAjIOWboOS4uuW5tuWIl+esrDXpg73mmK8zLjnvvIzmiYDku6XnrZvlh7rmnaU26KGMDQpmYWl0aGZ1bCA8LSBhc190aWJibGUoZmFpdGhmdWwpDQphZGRfcm93KGZhaXRoZnVsLCBlcnVwdGlvbnMgPSAxLCB3YWl0aW5nID0gMSkNCmBgYA0KDQoNCiMjIyDnrZvpgInooYwgYGZpbHRlcigpYA0KDQrnrZvpgInooYzlj6/ku6XnlKjkuIvmoIflrp7njrDvvIzlpoJgZmxpZ2h0c1s4OjEyLF1g77yMYGhlYWQoeCwgbilg5ZKMYHRhaWwoeCwgbilg5Lmf6IO95Y+W5pyA5YmN5oiW5ZCO6Iul5bmy6KGM44CC5L2GYGRwbHlyOjpmaWx0ZXIoKWDmmK/mnIDngbXmtLvnmoTjgIINCg0KYGBge3IgZmlsdGVyMX0NCiMg6YCJ5Y+WMeaciDHml6XnmoToiKrnj60NCm5ldzEgPC0gZmlsdGVyKGZsaWdodHMsIG1vbnRoID09IDEsIGRheSA9PSAxKQ0KaGVhZChuZXcxKQ0KDQojIOmAieWPljEx5pyI5oiWMTLmnIjnmoToiKrnj63vvIzms6jmhI8laW4l55qE55So5rOVDQpub3ZfZGVjIDwtIGZsaWdodHMgJT4lIGZpbHRlcihtb250aCAlaW4lIGMoMTEsIDEyKSkNCm5vdl9kZWMNCg0KIyDkvb/nlKjnrqHpgZPmk43kvZwNCm5vdF9jYW5jZWxsZWQgPC0gZmxpZ2h0cyAlPiUNCiAgZmlsdGVyKCFpcy5uYShkZXBfZGVsYXkpLCAhaXMubmEoYXJyX2RlbGF5KSkNCmBgYA0KDQpmaWx0ZXIoKSDlj6rog73nrZvpgInlh7rmnaHku7bkuLogVFJVRSDnmoTooYzvvJvlroPkvJrmjpLpmaTpgqPkupvmnaHku7bkuLogRkFMU0UgKirlkowgTkEg55qE6KGM44CC5aaC5p6c5oOz5L+d55WZ57y65aSx5YC877yM6ZyA6KaB5piO56Gu5oyH5Ye6KirjgIINCg0KIyMjIOe0ouW8leWIh+eJhyBgc2lsY2UoKWANCg0KYGRwbHlyOjpzbGljZShkYXRhLCAuLi4pYCDlj6/ku6XpgInmi6nmjIflrprluo/lj7fnmoTooYzlrZDpm4bvvIzmraPnmoTluo/lj7fooajnpLrkv53nlZnvvIzotJ/nmoTluo/lj7fooajnpLrmjpLpmaTjgILlpoLvvJoNCmBgYHtyfQ0KZmxpZ2h0cyAlPiUgc2xpY2UoMzo1KQ0KYGBgDQoNCiMjIyDljrvph43ooYwgYGRpc3RpbmN0KClgDQoNCmBkcGx5cjo6ZGlzdGluY3QoKWAg5Y+v5Lul5a+55pWw5o2u5qGG5oyH5a6a6Iul5bmy5Y+Y6YeP77yM54S25ZCO562b6YCJ5Ye65omA5pyJ5LiN5ZCM5YC877yM5q+P57uE5LiN5ZCM5YC85LuF5L+d55WZ5LiA6KGM44CCDQpgYGB7cn0NCmQuY2xhc3MgJT4lIGRpc3RpbmN0KHNleCwgYWdlLCAua2VlcF9hbGwgPSBUUlVFKQ0KIyAgLmtlZXBfYWxsPVRSVUUg5L+d55WZ5pWw5o2u5qGG5Lit5YW25a6D5Y+Y6YePDQpgYGANCg0KDQojIyMg5o6S5YiX6KGMIGBhcnJhbmdlKClgDQoNCmBgYHtyIGFycmFuZ2V9DQojIOS+neasoeaMiXllYXIsIG1vbnRoLCBkYXnmjpLluo/vvJvpu5jorqTljYfluo8NCm5ldzIgPC0gYXJyYW5nZShmbGlnaHRzLCB5ZWFyLCBtb250aCwgZGF5KQ0KaGVhZChuZXcyKQ0KDQojIOS9v+eUqGRlc2MoKeWPr+S7peaMieWIl+i/m+ihjOmZjeW6j+aOkuW6jw0KbmV3MiA8LSBhcnJhbmdlKGZsaWdodHMsIGRlc2MoYXJyX2RlbGF5KSkNCmhlYWQobmV3MikNCmBgYA0K5o6S5bqP5pe25LiN6K665Y2H5bqP6L+Y5piv6ZmN5bqP77yM5omA5pyJ55qE57y65aSx5YC86YO96Ieq5Yqo5o6S5Yiw5pyr5bC+44CCDQoNCg0KIyMg5pON5L2c5YiXIE1hbmlwdWxhdGUgQ29sb3VtDQoNCg0KIyMjIOaPkOWPluWIlyBgcHVsbCgpYA0KDQrpgInlh7rkuIDliJflubbku47mlbDmja7moYYqKui9rOWMluS4uuWQkemHjyoq77yM5YW25a6e5a6D5bCx5piv5pON5L2c56ymYCRg55qE5Ye95pWw5YyWDQoNCmBgYHtyfQ0KZC5jbGFzcyAlPiUgcHVsbChuYW1lKQ0KYGBgDQoNCmBwdWxsKClg5Y+v5Lul5oyH5a6a5Y2V5Liq5Y+Y6YeP5ZCN77yM5Lmf5Y+v5Lul5oyH5a6a5Y+Y6YeP5bqP5Y+377yM6LSf55qE5Y+Y6YeP5bqP5Y+35LuO5pyA5ZCO5LiA5Liq5Y+Y6YeP5pWw6LW344CCDQoNCg0KIyMjIOaMkemAieWIlyBgc2VsZWN0KClgDQoNCmBgYHtyIHNlbGVjdDF9DQpuZXczIDwtIHNlbGVjdChmbGlnaHRzLCB5ZWFyLCBtb250aCwgZGF5KQ0KaGVhZChuZXczKQ0KDQojIOWGkuWPtyI6IumAieaLqSB5ZWFyIOWSjCBhcnJfdGltZSDkuYvpl7TnmoTmiYDmnInliJcNCmZsaWdodHMgJT4lDQogIHNlbGVjdCh5ZWFyOmFycl90aW1lKSAlPiUNCiAgaGVhZCgpDQoNCiMg5Lmf5Y+v5Lul55So5pWw5a2X5bqP5Y+36KGo56S66IyD5Zu0DQpmbGlnaHRzICU+JQ0KICBzZWxlY3QoMTo3KSAlPiUNCiAgaGVhZCgpDQoNCiMg6LSf5Y+35oiWIeihqOekuuaJo+mZpA0KbmV3MyA8LSBzZWxlY3QoZmxpZ2h0cywgLSh5ZWFyOmRheSkpDQpoZWFkKG5ldzMpDQpgYGANCg0K5Y+v5Lul5Zyoc2VsZWN0KCnnmoTlj4LmlbDkuK3kvb/nlKjkuIDkupvovoXliqnlh73mlbDvvIznlYzlrprnrKblkIjmnaHku7bnmoTlj5jph48NCg0KKiBzdGFydHNfd2l0aCgiYWJjIikg5Yy56YWN5LulJ2FiYyflvIDlpLTnmoTlkI3np7DjgIINCiogZW5kc193aXRoKCJ4eXoiKSDljLnphY3ku6UneHl6J+e7k+WwvueahOWQjeensA0KKiBjb250YWlucygiaWprIikg5Yy56YWN5YyF5ZCrJ2lqayfnmoTlkI3np7ANCiogbWF0Y2hlcygiKC4pXFwxIikg6YCJ5oup5Yy56YWN5q2j5YiZ6KGo6L6+5byP55qE6YKj5Lqb5Y+Y6YePDQoqIG51bV9yYW5nZSgieCIsIDE6Mykg5Yy56YWNeDHjgIF4MuWSjHgzDQotIG9uZV9vZigpDQoNCmBgYHtyIHNlbGVjdDJ9DQpuZXczIDwtIHNlbGVjdChmbGlnaHRzLCBzdGFydHNfd2l0aCgiYyIpKQ0KaGVhZChuZXczKQ0KDQojIOWmguaenOimgemAieaLqeeahOWPmOmHj+WQjeW3sue7j+S/neWtmOS4uuS4gOS4quWtl+espuWei+WQkemHjw0KIyDlj6/ku6XnlKggb25lX29mKCkg5byV55So77yM55u05o6l5byV55So5ZCR6YeP5ZCN5Lya5oql6ZSZDQp2YXJzIDwtIGMoIm5hbWUiLCAic2V4IikNCmQuY2xhc3MgJT4lDQogIHNlbGVjdChvbmVfb2YodmFycykpDQpgYGANCg0KIyMjIOaOkuWIl+WIlyBgc2VsZWN0KC4uLiwgIGV2ZXJ5dGhpbmcoKSlgDQoNCuWwhnNlbGVjdCgp5Ye95pWw5ZKMZXZlcnl0aGluZygp6L6F5Yqp5Ye95pWw57uT5ZCI6LW35p2l5L2/55So44CC5b2T5oOz6KaB5bCG5Yeg5Liq5Y+Y6YeP56e75Yiw5pWw5o2u5qGG5byA5aS05pe277yM6L+Z56eN55So5rOV6Z2e5bi45aWP5pWI44CCDQpgYGB7ciBzZWxlY3Q0fQ0KbmV3MyA8LSBzZWxlY3QoZmxpZ2h0cywgdGltZV9ob3VyLCBhaXJfdGltZSwgZXZlcnl0aGluZygpKQ0KaGVhZChuZXczKQ0KYGBgDQoNCiMjIyDph43lkb3lkI3liJcgYHJlbmFtZSgpYA0KDQpgYGB7ciBzZWxlY3QzfQ0KIyDov5nkuKror63ms5XmnInngrnmgKrvvIzliY3ogIXmmK/mlrDliJflkI3vvIzlkI7ogIXmmK/ml6fliJflkI0NCmZsaWdodHMgJT4lDQogIHJlbmFtZSh0YWlsX251bSA9IHRhaWxudW0pICU+JQ0KICBoZWFkKCkNCmBgYA0KDQrms6jmhI/ov5nmoLfmlLnlkI3lrZfkuI3mmK/lr7nljp/lp4vmlbDmja7moYbkv67mlLnogIzmmK/ov5Tlm57mlLnkuoblkI3lrZflkI7nmoTmlrDmlbDmja7moYbjgIINCg0KDQojIyMg5re75Yqg5YiXIGBtdXRhdGUoKWANCg0KDQrku6XkuIvpg73mmK/lkJHph4/ljJblh73mlbDvvIzkuIDooYzkuIDooYzlnLDkvp3mrKHmk43kvZwNCg0KLSAgIGBtdXRhdGUoKWDvvIzmlrDlj5jph4/mt7vliqDlnKjmnIDlkI7kuIDliJfvvIzkuJTliJvlu7rnmoTmlrDlj5jph4/lj6/ku6Xnq4vljbPkvb/nlKjlnKjlj4LmlbDkuK0NCi0gICBgdHJhbnNtdXRlKClgLCDlpoLmnpzlj6rmg7Pkv53nlZnmlrDlj5jph4/lkozkuIDpg6jliIbml6flj5jph4/vvIzlj6/ku6Xkvb/nlKh0cmFuc211dGUoKeWHveaVsO+8jOacquiiq+aPkOWPiueahOWPmOmHj+S4jeS8muiiq+S/neeVmeOAgg0KLSAgIGBtdXRhdGVfYWxsKClgLCDorqHnrpfmlrDliJfopobnm5blkIzlkI3ml6fliJcNCi0gICBgbXV0YXRlX2lmKClgLCDmjInkuIDlrprmnaHku7borqHnrpfmlrDliJfopobnm5blkIzlkI3ml6fliJcNCi0gICBgYWRkX2NvbHVtbigpYO+8jOWQiOW5tuWIlw0KDQpgYGB7cn0NCmZsaWdodHMgJT4lDQogIHNlbGVjdCh5ZWFyOmRheSwgZW5kc193aXRoKCJkZWxheSIpLCBkaXN0YW5jZSwgYWlyX3RpbWUpICU+JQ0KICBtdXRhdGUoDQogICAgZ2FpbiA9IGFycl9kZWxheSAtIGRlcF9kZWxheSwNCiAgICBob3VycyA9IGFpcl90aW1lIC8gNjAsIHNwZWVkID0gZGlzdGFuY2UgLyBob3Vycw0KICApDQoNCmQuY2xhc3MgJT4lDQogIG11dGF0ZSgNCiAgICBjaGVpZ2h0ID0gaGVpZ2h0IC0gbWVhbihoZWlnaHQpDQogICkNCg0KZmxpZ2h0cyAlPiUgdHJhbnNtdXRlKGRlcF90aW1lLA0KICBob3VyID0gZGVwX3RpbWUgJS8lIDYwLA0KICBtaW51dGUgPSBkZXBfdGltZSAlJSA2MA0KKQ0KDQptdXRhdGVfYWxsKGZhaXRoZnVsLCBmdW5zKGxvZyguKSwgbG9nMiguKSkpDQoNCmlyaXMgPC0gYXNfdGliYmxlKGlyaXMpDQptdXRhdGVfaWYoaXJpcywgaXMubnVtZXJpYywgZnVucyhsb2coLikpKQ0KbXV0YXRlX2F0KGlyaXMsIHZhcnMoLVNwZWNpZXMpLCBmdW5zKGxvZyguKSkpDQphZGRfY29sdW1uKG10Y2FycywgbmV3ID0gMTozMikNCnJlbmFtZShpcmlzLCBMZW5ndGggPSBTZXBhbC5MZW5ndGgpDQpgYGANCg0KDQojIyMg6K6h566X5paw5YiX55qE5Ye95pWwDQoNCui/meS6m+WHveaVsOmFjeWQiCBgbXV0YXRlKClgIOWSjCBgdHJhbnNtdXRhdGUoKWDvvIxpbnB1dOS4gOS4quWIl+WQkemHj++8jG91dHB1dOS4gOS4quWIl+WQkemHjw0KDQojIyMjIOmhuuW6j+W6j+WPtw0KDQotIGBzZXFfYWxvbmcoYWxvbmcud2l0aClgIOagueaNrui+k+WFpeeahOWIl+eahOmVv+W6pu+8jOS6p+eUn+S4gOWIl+S7jjHliLBO55qE6aG65bqP5bqP5Y+377yM5b6I5YOPIGRhdGEudGFibGUg5YyF5Lit55qEYDE6Lk5gDQoNCiMjIyMg5YGP56e7IG9mZnNldA0KDQotICAgYGRwbHlyOjpsYWcoKWAg5ZCO6YCA5YGP56e7DQotICAgYGRwbHlyOjpsZWFkKClgIOWJjei/m+WBj+enuw0KDQojIyMjIOe0r+iuoSBjdW11bGF0aXZlDQoNCi0gICBgY3Vtc3VtKClgIOe0r+iuoeWSjO+8jOWIhue7hOWQjuiuoeeulzEtMTLmnIjntK/orqHlgLzpnZ7luLjmnInnlKgNCi0gICBgY3VtcHJvZCgpYCDntK/orqHnp68NCi0gICBgY3VtbWluKCkvY3VtbWF4YCDntK/orqHmnIDlsI8v5aSn5YC8DQotICAgYGRwbHlyOjpjdW1tZWFuKClgIOe0r+iuoeW5s+Wdh+WAvA0KLSAgIGBkcGx5cjo6Y3VtYWxsKClgIOe0r+iuoWFsbO+8iOmAu+i+keWIpOaWre+8iQ0KLSAgIGBkcGx5cjo6Y3VtYW55KClgIOe0r+iuoWFuee+8iOmAu+i+keWIpOaWre+8iQ0KDQojIyMjIOaOkuW6j+S9jee9riByYW5rDQoNCuingSBjaGVhdHNoZWV0DQoNCiMjIyMg5pWw5a2m6L+Q566XDQoNCuingSBjaGVhdHNoZWV0DQoNCiMjIyMg5YW25LuWDQoNCuingSBjaGVhdHNoZWV0DQoNCmBgYHtyfQ0KZGYgPC0gdGliYmxlKA0KICBuYW1lID0gYygiQWxpY2UiLCAiQWxpY2UiLCAiQm9iIiwgIkJvYiIsICJDYXJvbCIsICJDYXJvbCIpLA0KICB0eXBlID0gYygiZW5nbGlzaCIsICJtYXRoIiwgImVuZ2xpc2giLCAibWF0aCIsICJlbmdsaXNoIiwgIm1hdGgiKSwNCiAgc2NvcmUgPSBjKDYwLjIsIDkwLjUsIDkyLjIsIDk4LjgsIDgyLjUsIDc0LjYpDQopDQoNCiMgaWZfZWxzZSggLCAsICnvvIznlKggaWZlbHNlKCA/IDogKeS8muaKpemUmQ0KIyDlm6DkuLogaWZlbHNlKCkg5LiN5piv5ZCR6YeP5YyW6L+Q566X5Ye95pWwDQpkZiAlPiUgbXV0YXRlKA0KICBhc3Nlc3MgPSBpZl9lbHNlKHNjb3JlID4gODUsICJ2ZXJ5X2dvb2QiLCAiZ29vZCIpDQopDQoNCg0KZGYgJT4lIG11dGF0ZSgNCiAgYXNzZXNzID0gY2FzZV93aGVuKA0KICAgIHNjb3JlIDwgNzAgfiAiZ2VuZXJhbCIsDQogICAgc2NvcmUgPj0gNzAgJiBzY29yZSA8IDgwIH4gImdvb2QiLA0KICAgIHNjb3JlID49IDgwICYgc2NvcmUgPCA5MCB+ICJ2ZXJ5X2dvb2QiLA0KICAgIHNjb3JlID49IDkwIH4gImJlc3QiLA0KICAgIFRSVUUgfiAib3RoZXIiDQogICkNCikNCmBgYA0KDQoNCg0KIyMg5YiG57uE6KGMIEdyb3VwIFJvdw0KDQojIyMjIGBncm91cF9ieSgpYA0KDQrliJvlu7rkuIDkuKrliIblpb3nu4TnmoTljp/mlbDmja7nmoRjb3B577yM562J5b6F6L+b5LiA5q2l5oyH5Luk77yM54S25ZCO5YiG57uE5omn6KGM44CCDQoNCiMjIyMgYHVuZ3JvdXAoKWAgDQoNCumAhuaTjeS9nO+8jOeUn+aIkOS4gOS4quaVsOaNrueahCB1bmdyb3VwZWQgY29weQ0KDQpgYGB7cn0NCm10Y2FycyAlPiUNCiAgZ3JvdXBfYnkoY3lsKSAlPiUNCiAgc3VtbWFyaXNlKGF2ZyA9IG1lYW4obXBnKSkNCmdfaXJpcyA8LSBncm91cF9ieShpcmlzLCBTcGVjaWVzKQ0KdW5ncm91cChnX2lyaXMpDQpgYGANCg0K6Jm954S2Z3JvdXBfYnkoKeS4jnN1bW1hcml6ZSgp57uT5ZCI6LW35p2l5L2/55So5piv5pyA5pyJ5pWI55qE77yM5L2G5YiG57uE5Lmf5Y+v5Lul5LiOZmlsdGVyKCnlkoxtdXRhdGUoKee7k+WQiO+8jOS7peWujOaIkOmdnuW4uOS+v+aNt+eahOaTjeS9nO+8muWmgg0KDQoqIOaJvuWHuuavj+S4quWIhue7hOS4reacgOW3rueahOaIkOWRmA0KKiDmib7lh7rlpKfkuo7mn5DkuKrpmIjlgLznmoTmiYDmnInliIbnu4QNCiog5a+55pWw5o2u6L+b6KGM5qCH5YeG5YyW5Lul6K6h566X5YiG57uE5oyH5qCHDQoNCmBgYHtyfQ0KIyDmr4/lpKnliLDovr7lu7bor6/ml7bpl7TmnIDplb/nmoToiKrnj60NCmZsaWdodHMgJT4lDQogIHNlbGVjdCh5ZWFyOmRheSwgZW5kc193aXRoKCJkZWxheSIpLCBkaXN0YW5jZSwgYWlyX3RpbWUpICU+JQ0KICBncm91cF9ieSh5ZWFyLCBtb250aCwgZGF5KSAlPiUNCiAgZmlsdGVyKHJhbmsoZGVzYyhhcnJfZGVsYXkpKSA8IDEwKQ0KDQojIOWkp+S6jjM2NeS4quiIquePreeahOiIque6vw0KcG9wdWxhcl9kZXN0cyA8LSBmbGlnaHRzICU+JQ0KICBncm91cF9ieShkZXN0KSAlPiUNCiAgZmlsdGVyKG4oKSA+IDM2NSkNCnBvcHVsYXJfZGVzdHMNCg0KIyDlr7nmlbDmja7ov5vooYzmoIflh4bljJbku6XorqHnrpfliIbnu4TmjIfmoIcNCnBvcHVsYXJfZGVzdHMgJT4lDQogIGZpbHRlcihhcnJfZGVsYXkgPiAwKSAlPiUNCiAgbXV0YXRlKHByb3BfZGVsYXkgPSBhcnJfZGVsYXkgLyBzdW0oYXJyX2RlbGF5KSkgJT4lDQogIHNlbGVjdCh5ZWFyOmRheSwgZGVzdCwgYXJyX2RlbGF5LCBwcm9wX2RlbGF5KQ0KYGBgDQoNCiMjIyDmjInlpJrkuKrlj5jph4/liIbnu4QNCg0K5b2T5L2/55So5aSa5Liq5Y+Y6YeP6L+b6KGM5YiG57uE5pe277yM5q+P5qyh55qE5pGY6KaB57uf6K6h5Lya55So5o6J5LiA5Liq5YiG57uE5Y+Y6YeP44CC6L+Z5qC35bCx5Y+v5Lul6L275p2+5Zyw5a+55pWw5o2u6ZuG6L+b6KGM5b6q5bqP5riQ6L+b55qE5YiG5p6Q44CCDQoNCmBgYHtyIG11bHRpZ3JvdXB9DQpkYWlseSA8LSBncm91cF9ieShmbGlnaHRzLCB5ZWFyLCBtb250aCwgZGF5KQ0KKHBlcl9kYXkgPC0gc3VtbWFyaXplKGRhaWx5LCBmbGlnaHRzID0gbigpKSkNCihwZXJfbW9udGggPC0gc3VtbWFyaXplKHBlcl9kYXksIGZsaWdodHMgPSBzdW0oZmxpZ2h0cykpKQ0KKHBlcl95ZWFyIDwtIHN1bW1hcml6ZShwZXJfbW9udGgsIGZsaWdodHMgPSBzdW0oZmxpZ2h0cykpKQ0KYGBgDQoNCiMjIyDlj5bmtojliIbnu4QNCg0K5Y+W5raI5YiG57uE77yM5bm25Zue5Yiw5pyq5YiG57uE55qE5pWw5o2u57un57ut5pON5L2c77yM5Y+v5Lul5L2/55SoIHVuZ3JvdXAoKQ0KYGBge3IgdW5ncm91cCwgZGVwZW5kc29uPSdtdWx0aWdyb3VwJ30NCmRhaWx5ICU+JQ0KICB1bmdyb3VwKCkgJT4lICMg5Y+W5raI5YiG57uEDQogIHN1bW1hcml6ZShmbGlnaHRzID0gbigpKSAjIOWFqOW5tOaJgOacieiIquePrQ0KYGBgDQoNCiMjIOaRmOimgee7n+iuoeWIlyBTdW1tYXJpemUgQ29sdW1uDQoNCiMjIyMgYHN1bW1hcmlzZSgpYCDnu5/orqENCg0KKiAqKnN1bW1hcml6ZSgp5LiOZ3JvdXBfYnkoKeeahOe7hOWQiOaehOaIkOS6huS9v+eUqGRwbHly5YyF5pe25pyA5bi455So55qE5pON5L2c5LmL5LiA4oCU4oCU5YiG57uE5pGY6KaB57uf6K6h44CCKioNCiogc3VtbWFyaXplKCnlsIbnlJ/miJDkuIDkuKrmlrDnmoTmlbDmja7moYbvvIzljIXlkKvnmoTlj5jph4/lj6rmnInliIbnu4Tkvp3mja7lj5jph4/lkozlhpnov5tzdW1tYXJpemUoKeWPguaVsOeahOe7n+iuoeaRmOimgeWPmOmHj++8iOWPr+S7peS4gOasoee7n+iuoeWkmuS4qumHj++8iQ0KDQpgYGB7cn0NCm10Y2FycyAlPiUgc3VtbWFyaXNlKGF2ZyA9IG1lYW4obXBnKSkNCmBgYA0KDQoNCg0KIyMjIyBgY291bnQoKWAg5oyJ6K+l5YiX5YC855qEIGxldmVsIOWIhue7hOiuoeaVsA0KDQpgYGB7cn0NCmRmIDwtIHRpYmJsZSgNCiAgbmFtZSA9IGMoIkFsaWNlIiwgIkFsaWNlIiwgIkJvYiIsICJCb2IiLCAiQ2Fyb2wiLCAiQ2Fyb2wiKSwNCiAgdHlwZSA9IGMoImVuZ2xpc2giLCAibWF0aCIsICJlbmdsaXNoIiwgIm1hdGgiLCAiZW5nbGlzaCIsICJtYXRoIiksDQogIHNjb3JlID0gYyg2MC4yLCA5MC41LCA5Mi4yLCA5OC44LCA4Mi41LCA3NC42KQ0KKQ0KDQojIOWKoOadgyBjb3VudA0KZGYgJT4lIGNvdW50KG5hbWUsDQogIHNvcnQgPSBUUlVFLA0KICB3dCA9IHNjb3JlLA0KICBuYW1lID0gInRvdGFsX3Njb3JlIg0KKQ0KDQojIOetieS7t+S6jg0KZGYgJT4lDQogIGdyb3VwX2J5KG5hbWUpICU+JQ0KICBzdW1tYXJpc2UoDQogICAgbiA9IG4oKSwNCiAgICB0b3RhbF9zY29yZSA9IHN1bShzY29yZSwgbmEucm0gPSBUUlVFKQ0KICApICU+JQ0KICBhcnJhbmdlKGRlc2ModG90YWxfc2NvcmUpKQ0KYGBgDQoNCiMjIyMgYGFkZF9jb3VudCgpYCDlop7liqDkuIDkuKogY291bnQg5YiXDQoNCuWinuWKoOS4gOWIl++8jOS7o+ihqOavj+S6uuWPguWKoOeahOiAg+ivleasoeaVsA0KDQpgYGB7cn0NCmRmICU+JSBhZGRfY291bnQobmFtZSkNCg0KIyDnrYnku7fkuo4NCmRmICU+JQ0KICBncm91cF9ieShuYW1lKSAlPiUNCiAgbXV0YXRlKG4gPSBuKCkpICU+JQ0KICB1bmdyb3VwKCkNCmBgYA0KDQoNCg0KIyMjIOaRmOimgee7n+iuoeWHveaVsA0KDQrphY3lkIjlnKggYHN1bW1hcmlzZSgpYCDlhoXpg6jkvb/nlKjvvIzljaDmja7nrKzkuozkuKrlj4LmlbDkvY3nva7jgIJpbnB1dOS4gOS4quWQkemHj++8jG91dHB1dOS4gOS4quWAvOOAgg0KDQotICAgYHN1bSgpYCwgYG1lYW4oKWAsIGBjdW1zdW0oKWANCi0gICDnu5/orqHmgLsv5Y676YeN5ZCOL+mdnuepuuihjOaVsCBgbigpYCwgYG5fZGlzdGluY3QoKWAsIGBzdW0oIWlzLm5hKCkpYA0KLSAgIOWumuS9jeW6pumHjyBgZmlyc3QoKWAsIGBsYXN0KClgLCBgbnRoKClgDQotICAg56ep55qE5bqm6YePIGBtaW4oKWAsIGBtYXgoKWAsIGBxdWFudGlsZSh4LCAwLjI1KWANCi0gICDnprvmlaPnqIvluqYgYHNkKClg44CBYHZhcigpYCwgYG1hZCgpYCwgYElRUigpYA0KDQrkvosxIOinguWvn+iIquePreaVsOaNrueahOiLpeW5sue7n+iuoemHjw0KYGBge3IgZXhhbXBsZTF9DQojIGJ5X2RhdGXmmK9mbGlnaHRz5oyJ5bm05pyI5pel5YiG57uE5ZCO55qE5paw5pWw5o2uDQpieV9kYXRlIDwtIGdyb3VwX2J5KGZsaWdodHMsIHllYXIsIG1vbnRoLCBkYXkpDQojIOeUseatpOW+l+WIsOavj+S4gOWkqeeahOW5s+Wdh+W7tuivr+aXtumXtOOAgg0Kc3VtbWFyaXplKGJ5X2RhdGUsIGRlbGF5ID0gbWVhbihkZXBfZGVsYXksIG5hLnJtID0gVCkpDQoNCiMg5Lmf5Y+v5Lul55So566h6YGT5pON5L2c5YaZ5oiQDQpmbGlnaHRzICU+JQ0KICBncm91cF9ieSh5ZWFyLCBtb250aCwgZGF5KSAlPiUNCiAgc3VtbWFyaXplKGRlbGF5ID0gbWVhbihkZXBfZGVsYXksIG5hLnJtID0gVFJVRSkpDQoNCiMg5Lmf5Y+v5Lul6aKE5YWI5Y675o6J5a2Y5ZyoTkHvvIjoiKrnj63lj5bmtojvvInnmoTooYzvvIzlhpnmiJANCm5vdF9jYW5jZWxsZWQgPC0gZmxpZ2h0cyAlPiUNCiAgZmlsdGVyKCFpcy5uYShkZXBfZGVsYXkpLCAhaXMubmEoYXJyX2RlbGF5KSkNCg0Kbm90X2NhbmNlbGxlZCAlPiUNCiAgZ3JvdXBfYnkoeWVhciwgbW9udGgsIGRheSkgJT4lDQogIHN1bW1hcml6ZShkZWxheSA9IG1lYW4oZGVwX2RlbGF5KSkNCg0KIyDop4Llr5/lubPlnYfmraPlu7bor6/ml7bpl7QNCm5vdF9jYW5jZWxsZWQgJT4lDQogIGdyb3VwX2J5KHllYXIsIG1vbnRoLCBkYXkpICU+JQ0KICBzdW1tYXJpemUoZGVsYXlfcG9zID0gbWVhbihkZXBfZGVsYXlbZGVwX2RlbGF5ID4gMF0pKQ0KYGBgDQoNCuS+izIg5oyJ55uu55qE5Zyw5YiG57uE77yM5oyJ55uu55qE5Zyw5YiG57uE77yM56CU56m25bmz5Z2H6aOe6KGM6Led56a75LiO5bmz5Z2H5bu26K+v5pe26Ze05LmL6Ze055qE5YWz57O7DQpgYGB7ciBleGFtcGxlMn0NCiMg5qC55o2u55uu55qE5Zyw5YiG57uEDQpieV9kZXN0IDwtIGdyb3VwX2J5KGZsaWdodHMsIGRlc3QpDQoNCiMg55SobWVhbigp57uf6K6h5bmz5Z2H6aOe6KGM6Led56a75ZKM5bmz5Z2H5bu26K+v5pe26Ze0DQojIOeUqG4oKee7n+iuoeiIquePreaVsO+8jHN1bSghaXNfbmEoKSnpnZ7nvLrlpLHlgLzorrDmlbANCnN1bV9kYXRhIDwtIHN1bW1hcml6ZShieV9kZXN0LA0KICBjb3VudCA9IG4oKSwNCiAgZGlzdCA9IG1lYW4oZGlzdGFuY2UsIG5hLnJtID0gVFJVRSksDQogIGRlbGF5ID0gbWVhbihhcnJfZGVsYXksIG5hLnJtID0gVFJVRSkNCikNCg0KIyDnrZvpgInlh7roiKrnj63mlbDlpKfkuo4yMO+8iOWOu+mZpOWwj+agt+acrO+8ieS4lOebrueahOWcsOS4jeS4uidITkwn55qE6KGMDQojIEhOTOi/meS4quacuuWcuuWcqOWkj+WogeWkt++8jOi3neemu+Wkqui/nOWxnuS6juW8guW4uOWAvA0KZGVsYXkgPC0gZmlsdGVyKHN1bV9kYXRhLCBjb3VudCA+IDI5LCBkZXN0ICE9ICJITkwiKQ0KDQojIOS9nOWbvg0KZ2dwbG90KGRhdGEgPSBkZWxheSwgbWFwcGluZyA9IGFlcyh4ID0gZGlzdCwgeSA9IGRlbGF5KSkgKw0KICBnZW9tX3BvaW50KGFlcyhzaXplID0gY291bnQpLCBhbHBoYSA9IDEgLyAzKSArDQogIGdlb21fc21vb3RoKHNlID0gRkFMU0UpDQoNCg0KIyDnrqHpgZPmk43kvZwNCiMg6L+Z5qC35YaZ5Luj56CB5b6I5riF5pmw77yM5q+P5LiA6KGM5piv5LiA5q2l5pON5L2cDQpmbGlnaHRzICU+JQ0KICBncm91cF9ieShkZXN0KSAlPiUgIyDliIbnu4QNCiAgc3VtbWFyaXplKA0KICAgIGNvdW50ID0gbigpLCBkaXN0ID0gbWVhbihkaXN0YW5jZSwgbmEucm0gPSBUUlVFKSwNCiAgICBkZWxheSA9IG1lYW4oYXJyX2RlbGF5LCBuYS5ybSA9IFRSVUUpDQogICkgJT4lICMg57uf6K6hDQogIGZpbHRlcihjb3VudCA+IDI5LCBkZXN0ICE9ICJITkwiKSAlPiUgIyDnrZvpgInop4LmtYsNCiAgZ2dwbG90KG1hcHBpbmcgPSBhZXMoeCA9IGRpc3QsIHkgPSBkZWxheSkpICsNCiAgZ2VvbV9wb2ludChhZXMoc2l6ZSA9IGNvdW50KSwgYWxwaGEgPSAxIC8gMykgKw0KICBnZW9tX3Ntb290aChzZSA9IEZBTFNFKSAjIOS9nOWbvg0KYGBgDQrlj6/op4HvvIw3NTDoi7Hph4zlhoXvvIzlubPlnYflu7bor6/ml7bpl7TkvJrpmo/nnYDot53nprvnmoTlop7liqDogIzlop7liqDvvIzmjqXnnYDkvJrpmo/nnYDot53nprvnmoTlop7liqDogIzlh4/lsJHjgILmiJborrjvvIzpmo/nnYDpo57ooYzot53nprvnmoTlop7liqDvvIzlu7bor6/ml7bpl7TmnInlj6/og73kvJrlnKjpo57ooYzkuK3lvKXooaXlm57mnaXjgIINCg0K5L6LMyDmn6XnnIvlhbfmnInmnIDplb/lubPlnYflu7bor6/ml7bpl7TnmoToiKrnj60NCmBgYHtyIGV4YW1wbGUzLTEsIGRlcGVuZHNvbj0nZXhhbXBsZTEnfQ0KIyDpgJrov4flsL7lj7fvvIh0YWlsbnVt77yJ5a+56Iiq54+t6L+b6KGM5YiG57uE6K+G5YirDQpub3RfY2FuY2VsbGVkICU+JQ0KICBncm91cF9ieSh0YWlsbnVtKSAlPiUNCiAgc3VtbWFyaXplKGRlbGF5ID0gbWVhbihhcnJfZGVsYXkpKSAlPiUNCiAgZ2dwbG90KG1hcHBpbmcgPSBhZXMoeCA9IGRlbGF5KSkgKw0KICBnZW9tX2ZyZXFwb2x5KGJpbndpZHRoID0gMTApDQpgYGANCuacieS6m+iIquePreeahOW5s+Wdh+W7tuivr+aXtumXtOmVv+i+vjMwMOWIhumSn++8jOi/meaYr+aAjuS5iOWbnuS6i+WRou+8nw0KDQpgYGB7ciBleGFtcGxlMy0yLCBkZXBlbmRzb249J2V4YW1wbGUxJ30NCiMg5L2c6Iiq54+t5p625qyh5pWw6YeP5ZKM5bmz5Z2H5bu26K+v5pe26Ze055qE5pWj54K55Zu+DQpub3RfY2FuY2VsbGVkICU+JQ0KICBncm91cF9ieSh0YWlsbnVtKSAlPiUNCiAgc3VtbWFyaXplKGRlbGF5ID0gbWVhbihhcnJfZGVsYXkpLCBuID0gbigpKSAlPiUNCiAgZ2dwbG90KG1hcHBpbmcgPSBhZXMoeCA9IG4sIHkgPSBkZWxheSkpICsNCiAgZ2VvbV9wb2ludChhbHBoYSA9IDAuMSkNCmBgYA0K55Sx5Zu+5Y+v6KeB77yM5b2T6Iiq54+t5pWw6YeP6Z2e5bi45bCR5pe277yM5bmz5Z2H5bu26K+v5pe26Ze055qE5Y+Y5Yqo54m55Yir5aSn44CCDQoNCuazqO+8mui/meW8oOWbvueahOW9oueKtumdnuW4uOiDveWkn+ivtOaYjumXrumimO+8muW9k+e7mOWItuWdh+WAvO+8iOaIluWFtuS7luaRmOimgee7n+iuoemHj++8ieWSjOWIhue7hOinhOaooeeahOWFs+ezu+aXtu+8jOaAu+iDveeci+WIsOmaj+edgOagt+acrOmHj+eahOWinuWKoO+8jOWPmOWKqOWcqOS4jeaWreWHj+Wwj+OAguWboOatpO+8jOafpeeci+atpOexu+WbvuW9ouaXtu+8jCoq6YCa5bi45bqU6K+l562b6YCJ5o6J6YKj5Lqb6KeC5rWL5pWw6YeP6Z2e5bi45bCR55qE5YiG57uE77yM6L+Z5qC35bCx5Y+v5Lul6YG/5YWN5Y+X5Yiw54m55Yir5bCP55qE5YiG57uE5Lit55qE5p6B56uv5Y+Y5Yqo55qE5b2x5ZON77yM6L+b6ICM5pu05aW95Zyw5Y+R546w5pWw5o2u5qih5byPKirjgIINCg0KYGBge3IgZXhhbXBsZTMtMywgZGVwZW5kc29uPSdleGFtcGxlMSd9DQojIOS9nOWOu+aOieWwj+agt+acrOWQju+8jOiIquePreaetuasoeaVsOmHj+WSjOW5s+Wdh+W7tuivr+aXtumXtOeahOaVo+eCueWbvg0Kbm90X2NhbmNlbGxlZCAlPiUNCiAgZ3JvdXBfYnkodGFpbG51bSkgJT4lDQogIHN1bW1hcml6ZShkZWxheSA9IG1lYW4oYXJyX2RlbGF5KSwgbiA9IG4oKSkgJT4lDQogIGZpbHRlcihuID49IDMwKSAlPiUNCiAgZ2dwbG90KG1hcHBpbmcgPSBhZXMoeCA9IG4sIHkgPSBkZWxheSkpICsNCiAgZ2VvbV9wb2ludChhbHBoYSA9IDAuMSkgKw0KICBnZW9tX3Ntb290aChtZXRob2QgPSAibG0iLCBzZSA9IEZBTFNFKQ0KYGBgDQrov5nml7bmiJHku6zlj5HnjrDvvIzlubPlnYflu7bor6/ml7bpl7TlpKflpJrlnKgyMOWIhumSn+S7peS4i++8m+mjnuihjOaetuasoeWcqDMw5Lul5LiK55qE6Iiq54+t77yM5bmz5Z2H5bu26K+v5pe26Ze05pyA6ZW/55qE5Lmf5Y+q5pyJNjDliIbpkp/jgIINCg0KDQrkvos0IOajkueQg+WHu+eQg+aJi+eahOWuieaJk+eOh+S4juWHu+eQg+asoeaVsOS5i+mXtOeahOWFs+ezu++8iOiDveWKm+S4juWHuuWcuuacuuS8mueahOWFs+ezu++8iQ0KYGBge3IgZXhhbXBsZTR9DQojIOajkueQg+avlOi1m+aVsOaNru+8jOi9rOaNouaIkHRpYmJsZeS9v+i+k+WHuuabtOe+juingg0KYmF0dGluZyA8LSBhc190aWJibGUoTGFobWFuOjpCYXR0aW5nKQ0KDQojIOagueaNrueQg+WRmElE5YiG57uE57uf6K6h77yM5oC75Ye75omT5pWwYWLlkozlronmiZPnjodiYe+8iOWuieaJk+aVsC/lh7vmiZPmlbDvvIkNCiMg5YiG57uE57uf6K6h5ZCO5YyF5ZCrcGxheWVySUQsIGFiLCBiYeWPmOmHj+eahOaWsOaVsOaNruahhuS4umJhdHRlcnMNCmJhdHRlcnMgPC0gYmF0dGluZyAlPiUNCiAgZ3JvdXBfYnkocGxheWVySUQpICU+JQ0KICBzdW1tYXJpemUoDQogICAgYmEgPSBzdW0oSCwgbmEucm0gPSBUUlVFKSAvIHN1bShBQiwgbmEucm0gPSBUUlVFKSwNCiAgICBhYiA9IHN1bShBQiwgbmEucm0gPSBUUlVFKQ0KICApDQoNCiMg5oyJ5a6J5omT546H5o6S5ZCN77yM5Y+R546w5L2N5qyh5pyA6Z2g5YmN55qE5piv5LiA5Lqb5oC75Ye75omT5pWw5Yeg5LmO5Li66Zu244CBDQojIOmdoOWlvei/kOawlOiOt+W+l+aegemrmOWuieaJk+eOh+eahOeQg+WRmOKAlOKAlOiAjOi/meW5tuS4jeihqOaYjuiDveWKm+W8uuOAgg0KYmF0dGVycyAlPiUgYXJyYW5nZShkZXNjKGJhKSkNCmJhdHRlcnMgJT4lIGdncGxvdChtYXBwaW5nID0gYWVzKHggPSBhYiwgeSA9IGJhKSkgKw0KICBnZW9tX3BvaW50KGFscGhhID0gMC4xKQ0KDQojIOW/veeVpeWwj+agt+acrO+8jOe7mOWItuWuieaJk+eOh37lh7vmiZPmlbDmlaPngrnlm77vvIzlj5HnjrDlronmiZPnjofln7rmnKzlsI/kuo4zNSUNCiMg5q2j55u45YWz5YWz57O777yM6K+05piO5a6J5omT546H6L6D6auY55qE55CD5ZGY5Ye75omT5pWw6L6D5aSa77yI5Ye65Zy65py65Lya5aSa77yJDQojIOeUseWbvuWPr+inge+8jOaLpeaciTIwJeS7peS4iueahOWuieaJk+eOh++8jOaJjeacieacuuS8muaIkOS4uueQg+mYn+S4u+WKmw0KYmF0dGVycyAlPiUNCiAgZmlsdGVyKGFiID4gMTAwKSAlPiUNCiAgZ2dwbG90KG1hcHBpbmcgPSBhZXMoeCA9IGFiLCB5ID0gYmEpKSArDQogIGdlb21fcG9pbnQoYWxwaGEgPSAwLjEpICsNCiAgZ2VvbV9zbW9vdGgoc2UgPSBGQUxTRSkNCmBgYA0KDQpgYGB7ciBvdGhlcjEsIGRlcGVuZHNvbj0nZXhhbXBsZTEnfQ0KIyDku45OLlku5Yiw5YW25LuW5py65Zy66aOe6KGM6Led56a755qE5qCH5YeG5beuDQpub3RfY2FuY2VsbGVkICU+JQ0KICBncm91cF9ieShkZXN0KSAlPiUNCiAgc3VtbWFyaXplKGRpc3RhbmNlX3NkID0gc2QoZGlzdGFuY2UpKSAlPiUNCiAgYXJyYW5nZShkZXNjKGRpc3RhbmNlX3NkKSkNCmBgYA0KDQpgYGB7ciBvdGhlcjIsIGRlcGVuZHNvbj0nZXhhbXBsZTEnfQ0KIyDmr4/lpKnmnIDml6nlkozmnIDmmZroiKrnj63nmoTlh7rlj5Hml7bpl7QNCm5vdF9jYW5jZWxsZWQgJT4lDQogIGdyb3VwX2J5KHllYXIsIG1vbnRoLCBkYXkpICU+JQ0KICBzdW1tYXJpemUoZmlyc3QgPSBtaW4oZGVwX3RpbWUpLCBsYXN0ID0gbWF4KGRlcF90aW1lKSkNCg0KIyDmib7lh7rmr4/lpKnmnIDml6nlkozmnIDmmZrlh7rlj5HnmoToiKrnj60NCiMgbWluX3JhbmsoeCnlj6/ku6Xov5Tlm57kuIDkuKrluo/liJflkITlhYPntKDnmoTljYfluo/kvY3nva7lkJHph48NCiMgbWluX3JhbmsoZGVzYyh4KSnov5Tlm57pmY3luo/kvY3nva7lkJHph48NCiMg5a+55Ye65Y+R5pe26Ze05o6S5bqP5ZCO77yM55SocmFuZ2UoKeWPluWHuuacgOWkp+WAvOWSjOacgOWwj+WAvA0KIyDlho3nlKhmaWx0ZXIoKeWPluWHuuavj+WkqeWHuuWPkeacgOaXqeWSjOacgOaZmueahOiIquePrQ0Kbm90X2NhbmNlbGxlZCAlPiUNCiAgZ3JvdXBfYnkoeWVhciwgbW9udGgsIGRheSkgJT4lDQogIG11dGF0ZShyID0gbWluX3JhbmsoZGVzYyhkZXBfdGltZSkpKSAlPiUNCiAgZmlsdGVyKHIgJWluJSByYW5nZShyKSkNCmBgYA0KDQpgYGB7ciBvdGhlcjQsIGRlcGVuZHNvbj0nZXhhbXBsZTEnfQ0KIyDnur3nuqboh7Plk6rkuKrnm67nmoTlnLDnmoToiKrnur/mnInmnIDlpJrnmoToiKrnqbrlhazlj7jov5DokKUNCiMgbl9kaXN0aW5jdCgp5Ye95pWw57uf6K6h5ZSv5LiA5YC855qE5pWw6YePDQpub3RfY2FuY2VsbGVkICU+JQ0KICBncm91cF9ieShkZXN0KSAlPiUNCiAgc3VtbWFyaXplKGNhcnJpZXJzID0gbl9kaXN0aW5jdChjYXJyaWVyKSkgJT4lDQogIGFycmFuZ2UoZGVzYyhjYXJyaWVycykpDQoNCiMg57q957qm5Ye65Y+R55qE5q+P5p2h6Iiq57q/5pyJ5aSa5bCR5Liq6Iiq54+tDQpub3RfY2FuY2VsbGVkICU+JSBjb3VudChkZXN0KQ0KDQojIOWKoOadg+iusOaVsO+8jOiuoeeul+avj+S4quiIquePreeahOaAu+mjnuihjOi3neemuw0Kbm90X2NhbmNlbGxlZCAlPiUgY291bnQodGFpbG51bSwgd3QgPSBkaXN0YW5jZSkNCmBgYA0KDQpgYGB7ciBvdGhlcjUsIGRlcGVuZHNvbj0nZXhhbXBsZTEnfQ0KIyDoi6V45Li66YC76L6R5ZCR6YeP77yMc3VtKHgp5Y+v5Lul5om+5Ye6eOS4rVRSVUXnmoTmlbDph4/vvIxtZWFuKHgp5Y+v5Lul5om+5Ye6eOS4rVRSVUXnmoTmr5TkvovjgIINCiMg5q+P5aSp5pyJ5aSa5bCR5p626Iiq54+t5piv5pep5LiKNeeCueWJjeWHuuWPkeeahA0Kbm90X2NhbmNlbGxlZCAlPiUNCiAgZ3JvdXBfYnkoeWVhciwgbW9udGgsIGRheSkgJT4lDQogIHN1bW1hcml6ZShuX2Vhcmx5ID0gc3VtKGRlcF90aW1lIDwgNTAwKSkNCg0KIyDlu7bor6/otoXov4cx5bCP5pe255qE6Iiq54+t5q+U5L6L5piv5aSa5bCRDQpub3RfY2FuY2VsbGVkICU+JQ0KICBncm91cF9ieSh5ZWFyLCBtb250aCwgZGF5KSAlPiUNCiAgc3VtbWFyaXplKGhvdXJfcGVyYyA9IG1lYW4oYXJyX2RlbGF5ID4gNjApKQ0KYGBgDQo=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("2单表数据处理.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
